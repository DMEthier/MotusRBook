<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>5 Data Cleaning | Motus R Book</title>
  <meta name="description" content="5 Data Cleaning | Motus R Book" />
  <meta name="generator" content="bookdown 0.18 and GitBook 2.6.7" />

  <meta property="og:title" content="5 Data Cleaning | Motus R Book" />
  <meta property="og:type" content="book" />
  
  <meta property="og:image" content="BSC_Motus_Logo.png" />
  
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="5 Data Cleaning | Motus R Book" />
  
  
  <meta name="twitter:image" content="BSC_Motus_Logo.png" />

<meta name="author" content="Tara L. Crewe, Zoe Crysler, and Philip Taylor" />



  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="deployments.html"/>
<link rel="next" href="exploreData.html"/>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />









<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-12387576-13', 'auto');
  ga('send', 'pageview');

</script>


<style type="text/css">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; left: -4em; }
pre.numberSource a.sourceLine::before
  { content: attr(data-line-number);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><strong><a href="./">R for Motus</a></strong></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>A walk through the use of R for Motus automated radio-telemetry data</a></li>
<li class="chapter" data-level="1" data-path="introduction.html"><a href="introduction.html"><i class="fa fa-check"></i><b>1</b> Introduction</a><ul>
<li class="chapter" data-level="1.1" data-path="introduction.html"><a href="introduction.html#whatBookCovers"><i class="fa fa-check"></i><b>1.1</b> What this book does not cover</a></li>
<li class="chapter" data-level="1.2" data-path="introduction.html"><a href="introduction.html#prerequisites"><i class="fa fa-check"></i><b>1.2</b> Prerequisites</a></li>
<li class="chapter" data-level="1.3" data-path="introduction.html"><a href="introduction.html#sampleData"><i class="fa fa-check"></i><b>1.3</b> Sample datasets</a></li>
<li class="chapter" data-level="1.4" data-path="introduction.html"><a href="introduction.html#acknowledgements"><i class="fa fa-check"></i><b>1.4</b> Acknowledgements</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="loadingPackages.html"><a href="loadingPackages.html"><i class="fa fa-check"></i><b>2</b> Loading R Packages</a><ul>
<li class="chapter" data-level="2.1" data-path="loadingPackages.html"><a href="loadingPackages.html#installing-motus-packages"><i class="fa fa-check"></i><b>2.1</b> Installing Motus packages</a><ul>
<li class="chapter" data-level="2.1.1" data-path="loadingPackages.html"><a href="loadingPackages.html#troubleshooting-the-installation"><i class="fa fa-check"></i><b>2.1.1</b> Troubleshooting the installation</a></li>
</ul></li>
<li class="chapter" data-level="2.2" data-path="loadingPackages.html"><a href="loadingPackages.html#installing-other-packages"><i class="fa fa-check"></i><b>2.2</b> Installing other packages</a></li>
<li class="chapter" data-level="2.3" data-path="loadingPackages.html"><a href="loadingPackages.html#internalProcessing"><i class="fa fa-check"></i><b>2.3</b> Internal data processing</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="accessingData.html"><a href="accessingData.html"><i class="fa fa-check"></i><b>3</b> Accessing and understanding detections data</a><ul>
<li class="chapter" data-level="3.1" data-path="accessingData.html"><a href="accessingData.html#databaseStructure"><i class="fa fa-check"></i><b>3.1</b> Data structure</a></li>
<li class="chapter" data-level="3.2" data-path="accessingData.html"><a href="accessingData.html#databaseTypes"><i class="fa fa-check"></i><b>3.2</b> Database types</a></li>
<li class="chapter" data-level="3.3" data-path="accessingData.html"><a href="accessingData.html#loadPackages"><i class="fa fa-check"></i><b>3.3</b> Load relevant R packages</a></li>
<li class="chapter" data-level="3.4" data-path="accessingData.html"><a href="accessingData.html#set-system-environment"><i class="fa fa-check"></i><b>3.4</b> Set system environment</a></li>
<li class="chapter" data-level="3.5" data-path="accessingData.html"><a href="accessingData.html#importDetections"><i class="fa fa-check"></i><b>3.5</b> Downloading tag detections</a><ul>
<li class="chapter" data-level="3.5.1" data-path="accessingData.html"><a href="accessingData.html#downloadData"><i class="fa fa-check"></i><b>3.5.1</b> Download data for a project for the <em>first time</em></a></li>
<li class="chapter" data-level="3.5.2" data-path="accessingData.html"><a href="accessingData.html#userAuthentication"><i class="fa fa-check"></i><b>3.5.2</b> User Authentication</a></li>
<li class="chapter" data-level="3.5.3" data-path="accessingData.html"><a href="accessingData.html#download-data-for-a-receiver-for-the-first-time"><i class="fa fa-check"></i><b>3.5.3</b> Download data for a receiver for the <em>first time</em></a></li>
<li class="chapter" data-level="3.5.4" data-path="accessingData.html"><a href="accessingData.html#downloading-multiple-receivers-at-the-same-time"><i class="fa fa-check"></i><b>3.5.4</b> Downloading multiple receivers at the same time</a></li>
<li class="chapter" data-level="3.5.5" data-path="accessingData.html"><a href="accessingData.html#updating-all-.motus-files-within-a-directory"><i class="fa fa-check"></i><b>3.5.5</b> Updating all .motus files within a directory</a></li>
<li class="chapter" data-level="3.5.6" data-path="accessingData.html"><a href="accessingData.html#accessSQL"><i class="fa fa-check"></i><b>3.5.6</b> Accessing downloaded detection data</a></li>
<li class="chapter" data-level="3.5.7" data-path="accessingData.html"><a href="accessingData.html#convertToFlat"><i class="fa fa-check"></i><b>3.5.7</b> Converting to flat file</a></li>
</ul></li>
<li class="chapter" data-level="3.6" data-path="accessingData.html"><a href="accessingData.html#exportDetections"><i class="fa fa-check"></i><b>3.6</b> Export your ‘flat’ dataframe to CSV or RDS file</a></li>
<li class="chapter" data-level="3.7" data-path="accessingData.html"><a href="accessingData.html#tagmeUpdate"><i class="fa fa-check"></i><b>3.7</b> Update and/or open an existing database</a></li>
<li class="chapter" data-level="3.8" data-path="accessingData.html"><a href="accessingData.html#tellme"><i class="fa fa-check"></i><b>3.8</b> Check if new data are available</a></li>
<li class="chapter" data-level="3.9" data-path="accessingData.html"><a href="accessingData.html#forceMeta"><i class="fa fa-check"></i><b>3.9</b> Force an update/re-import of tag and receiver deployment metadata</a></li>
<li class="chapter" data-level="3.10" data-path="accessingData.html"><a href="accessingData.html#metadata"><i class="fa fa-check"></i><b>3.10</b> Import full tag and receiver metadata</a></li>
<li class="chapter" data-level="3.11" data-path="accessingData.html"><a href="accessingData.html#checkVersion"><i class="fa fa-check"></i><b>3.11</b> Ensure that you have the correct database version</a></li>
<li class="chapter" data-level="3.12" data-path="accessingData.html"><a href="accessingData.html#r-object-naming-convention"><i class="fa fa-check"></i><b>3.12</b> R object naming convention</a></li>
<li class="chapter" data-level="3.13" data-path="accessingData.html"><a href="accessingData.html#importSummary"><i class="fa fa-check"></i><b>3.13</b> Summary: download, access, and export data</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="deployments.html"><a href="deployments.html"><i class="fa fa-check"></i><b>4</b> Tag and Receiver Deployments</a><ul>
<li class="chapter" data-level="4.1" data-path="deployments.html"><a href="deployments.html#load-relevant-r-packages-and-set-working-environment"><i class="fa fa-check"></i><b>4.1</b> Load relevant R packages and set working environment</a></li>
<li class="chapter" data-level="4.2" data-path="deployments.html"><a href="deployments.html#load-.motus-file"><i class="fa fa-check"></i><b>4.2</b> Load .motus file</a></li>
<li class="chapter" data-level="4.3" data-path="deployments.html"><a href="deployments.html#tagDeployments"><i class="fa fa-check"></i><b>4.3</b> Tag Deployments</a><ul>
<li class="chapter" data-level="4.3.1" data-path="deployments.html"><a href="deployments.html#download-full-project-tag-metadata"><i class="fa fa-check"></i><b>4.3.1</b> Download full project tag metadata</a></li>
<li class="chapter" data-level="4.3.2" data-path="deployments.html"><a href="deployments.html#number-of-registered-tags"><i class="fa fa-check"></i><b>4.3.2</b> Number of registered tags</a></li>
<li class="chapter" data-level="4.3.3" data-path="deployments.html"><a href="deployments.html#number-of-registered-tags-that-were-deployed"><i class="fa fa-check"></i><b>4.3.3</b> Number of registered tags that were deployed</a></li>
<li class="chapter" data-level="4.3.4" data-path="deployments.html"><a href="deployments.html#checkNumberTagDeployments"><i class="fa fa-check"></i><b>4.3.4</b> Number of deployments per tag</a></li>
<li class="chapter" data-level="4.3.5" data-path="deployments.html"><a href="deployments.html#location-of-tag-deployments"><i class="fa fa-check"></i><b>4.3.5</b> Location of tag deployments</a></li>
<li class="chapter" data-level="4.3.6" data-path="deployments.html"><a href="deployments.html#check-completeness-and-accuracy-of-tag-deployment-metadata"><i class="fa fa-check"></i><b>4.3.6</b> Check completeness and accuracy of tag deployment metadata</a></li>
</ul></li>
<li class="chapter" data-level="4.4" data-path="deployments.html"><a href="deployments.html#recvMetadata"><i class="fa fa-check"></i><b>4.4</b> Check Receiver Metadata</a><ul>
<li class="chapter" data-level="4.4.1" data-path="deployments.html"><a href="deployments.html#download-full-receiver-metadata"><i class="fa fa-check"></i><b>4.4.1</b> Download full receiver metadata</a></li>
<li class="chapter" data-level="4.4.2" data-path="deployments.html"><a href="deployments.html#number-of-project-receiver-deployments"><i class="fa fa-check"></i><b>4.4.2</b> Number of project receiver deployments</a></li>
<li class="chapter" data-level="4.4.3" data-path="deployments.html"><a href="deployments.html#timing-of-project-receiver-deployments"><i class="fa fa-check"></i><b>4.4.3</b> Timing of project receiver deployments</a></li>
<li class="chapter" data-level="4.4.4" data-path="deployments.html"><a href="deployments.html#location-of-receiver-deployments"><i class="fa fa-check"></i><b>4.4.4</b> Location of receiver deployments</a></li>
<li class="chapter" data-level="4.4.5" data-path="deployments.html"><a href="deployments.html#completeness-and-accuracy-of-receiver-metadata"><i class="fa fa-check"></i><b>4.4.5</b> Completeness and accuracy of receiver metadata</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="5" data-path="dataCleaning.html"><a href="dataCleaning.html"><i class="fa fa-check"></i><b>5</b> Data Cleaning</a><ul>
<li class="chapter" data-level="5.1" data-path="dataCleaning.html"><a href="dataCleaning.html#loadDetectionsCleaning"><i class="fa fa-check"></i><b>5.1</b> Load required packages</a></li>
<li class="chapter" data-level="5.2" data-path="dataCleaning.html"><a href="dataCleaning.html#load-detections-data"><i class="fa fa-check"></i><b>5.2</b> Load detections data</a></li>
<li class="chapter" data-level="5.3" data-path="dataCleaning.html"><a href="dataCleaning.html#assess-tag-detections"><i class="fa fa-check"></i><b>5.3</b> Assess tag detections</a></li>
<li class="chapter" data-level="5.4" data-path="dataCleaning.html"><a href="dataCleaning.html#preliminary-filtering"><i class="fa fa-check"></i><b>5.4</b> Preliminary filtering</a><ul>
<li class="chapter" data-level="5.4.1" data-path="dataCleaning.html"><a href="dataCleaning.html#understanding-the-motusfilter"><i class="fa fa-check"></i><b>5.4.1</b> Understanding the <code>motusFilter</code></a></li>
<li class="chapter" data-level="5.4.2" data-path="dataCleaning.html"><a href="dataCleaning.html#how-the-motusfilter-is-generated"><i class="fa fa-check"></i><b>5.4.2</b> How the <code>motusFilter</code> is generated</a></li>
<li class="chapter" data-level="5.4.3" data-path="dataCleaning.html"><a href="dataCleaning.html#custom-filters-with-the-filterbyactivity-function"><i class="fa fa-check"></i><b>5.4.3</b> Custom filters with the <code>filterByActivity()</code> function</a></li>
</ul></li>
<li class="chapter" data-level="5.5" data-path="dataCleaning.html"><a href="dataCleaning.html#preparing-the-data"><i class="fa fa-check"></i><b>5.5</b> Preparing the data</a><ul>
<li class="chapter" data-level="5.5.1" data-path="dataCleaning.html"><a href="dataCleaning.html#label-detections-by-probability"><i class="fa fa-check"></i><b>5.5.1</b> Label detections by probability</a></li>
<li class="chapter" data-level="5.5.2" data-path="dataCleaning.html"><a href="dataCleaning.html#clean-up"><i class="fa fa-check"></i><b>5.5.2</b> Clean up</a></li>
<li class="chapter" data-level="5.5.3" data-path="dataCleaning.html"><a href="dataCleaning.html#addGPS"><i class="fa fa-check"></i><b>5.5.3</b> Add GPS data</a></li>
</ul></li>
<li class="chapter" data-level="5.6" data-path="dataCleaning.html"><a href="dataCleaning.html#preliminary-data-checks"><i class="fa fa-check"></i><b>5.6</b> Preliminary data checks</a><ul>
<li class="chapter" data-level="5.6.1" data-path="dataCleaning.html"><a href="dataCleaning.html#summarize-tag-detections"><i class="fa fa-check"></i><b>5.6.1</b> Summarize tag detections</a></li>
</ul></li>
<li class="chapter" data-level="5.7" data-path="dataCleaning.html"><a href="dataCleaning.html#ambigs"><i class="fa fa-check"></i><b>5.7</b> Examining ambiguous detections</a></li>
<li class="chapter" data-level="5.8" data-path="dataCleaning.html"><a href="dataCleaning.html#checking-validity-of-run-lengths-of-2-or-3"><i class="fa fa-check"></i><b>5.8</b> Checking validity of run lengths of 2 or 3</a></li>
<li class="chapter" data-level="5.9" data-path="dataCleaning.html"><a href="dataCleaning.html#filtering-the-data"><i class="fa fa-check"></i><b>5.9</b> Filtering the data</a><ul>
<li class="chapter" data-level="5.9.1" data-path="dataCleaning.html"><a href="dataCleaning.html#filter-and-save-to-rds"><i class="fa fa-check"></i><b>5.9.1</b> Filter and save to RDS</a></li>
<li class="chapter" data-level="5.9.2" data-path="dataCleaning.html"><a href="dataCleaning.html#saveFilter"><i class="fa fa-check"></i><b>5.9.2</b> Save a custom filter in the motus database, and apply it to the data</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="6" data-path="exploreData.html"><a href="exploreData.html"><i class="fa fa-check"></i><b>6</b> Exploring data with the Motus R package</a><ul>
<li class="chapter" data-level="6.1" data-path="exploreData.html"><a href="exploreData.html#load-required-packages"><i class="fa fa-check"></i><b>6.1</b> Load required packages</a></li>
<li class="chapter" data-level="6.2" data-path="exploreData.html"><a href="exploreData.html#load-data"><i class="fa fa-check"></i><b>6.2</b> Load data</a></li>
<li class="chapter" data-level="6.3" data-path="exploreData.html"><a href="exploreData.html#dataSummaries"><i class="fa fa-check"></i><b>6.3</b> Summarizing your data</a></li>
<li class="chapter" data-level="6.4" data-path="exploreData.html"><a href="exploreData.html#dataPlotting"><i class="fa fa-check"></i><b>6.4</b> Plotting your data</a></li>
<li class="chapter" data-level="6.5" data-path="exploreData.html"><a href="exploreData.html#mappingData"><i class="fa fa-check"></i><b>6.5</b> Mapping your data</a><ul>
<li class="chapter" data-level="6.5.1" data-path="exploreData.html"><a href="exploreData.html#ggmaps"><i class="fa fa-check"></i><b>6.5.1</b> Mapping with the <code>ggmap</code> package</a></li>
<li class="chapter" data-level="6.5.2" data-path="exploreData.html"><a href="exploreData.html#outlineMaps"><i class="fa fa-check"></i><b>6.5.2</b> Creating simple outline maps</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="7" data-path="vanishingBearings.html"><a href="vanishingBearings.html"><i class="fa fa-check"></i><b>7</b> Vanishing bearings</a><ul>
<li class="chapter" data-level="7.1" data-path="vanishingBearings.html"><a href="vanishingBearings.html#thingsToBeAwareOf"><i class="fa fa-check"></i><b>7.1</b> Things to be aware of</a></li>
<li class="chapter" data-level="7.2" data-path="vanishingBearings.html"><a href="vanishingBearings.html#estimateBearings"><i class="fa fa-check"></i><b>7.2</b> Estimate vanishing bearings: step-by-step</a><ul>
<li class="chapter" data-level="7.2.1" data-path="vanishingBearings.html"><a href="vanishingBearings.html#loadPackages7"><i class="fa fa-check"></i><b>7.2.1</b> Load the required packages</a></li>
<li class="chapter" data-level="7.2.2" data-path="vanishingBearings.html"><a href="vanishingBearings.html#vanishingSample"><i class="fa fa-check"></i><b>7.2.2</b> Load the sample data</a></li>
<li class="chapter" data-level="7.2.3" data-path="vanishingBearings.html"><a href="vanishingBearings.html#select-individuals-that-show-clear-departure-detections"><i class="fa fa-check"></i><b>7.2.3</b> Select individuals that show clear departure detections</a></li>
<li class="chapter" data-level="7.2.4" data-path="vanishingBearings.html"><a href="vanishingBearings.html#obtain-departure-times"><i class="fa fa-check"></i><b>7.2.4</b> Obtain departure times</a></li>
<li class="chapter" data-level="7.2.5" data-path="vanishingBearings.html"><a href="vanishingBearings.html#calculate-vanishing-bearings-for-individuals-with-departure-times."><i class="fa fa-check"></i><b>7.2.5</b> Calculate vanishing bearings for individuals with departure times.</a></li>
<li class="chapter" data-level="7.2.6" data-path="vanishingBearings.html"><a href="vanishingBearings.html#plot-the-vanishing-bearings-on-a-map"><i class="fa fa-check"></i><b>7.2.6</b> Plot the vanishing bearings on a map</a></li>
</ul></li>
<li class="chapter" data-level="7.3" data-path="vanishingBearings.html"><a href="vanishingBearings.html#vanishingLitCited"><i class="fa fa-check"></i><b>7.3</b> Literature Cited</a></li>
</ul></li>
<li class="chapter" data-level="8" data-path="advancedModelling.html"><a href="advancedModelling.html"><i class="fa fa-check"></i><b>8</b> Advanced modelling and analysis</a></li>
<li class="appendix"><span><b>Appendix</b></span></li>
<li class="chapter" data-level="A" data-path="appendixA.html"><a href="appendixA.html"><i class="fa fa-check"></i><b>A</b> Appendix - <code>alltags</code> and <code>alltagsGPS</code> structure</a></li>
<li class="chapter" data-level="B" data-path="appendixB.html"><a href="appendixB.html"><i class="fa fa-check"></i><b>B</b> Appendix - Troubleshooting</a><ul>
<li class="chapter" data-level="B.1" data-path="appendixB.html"><a href="appendixB.html#motusLogout"><i class="fa fa-check"></i><b>B.1</b> Logging out of motus</a></li>
<li class="chapter" data-level="B.2" data-path="appendixB.html"><a href="appendixB.html#resumeDownload"><i class="fa fa-check"></i><b>B.2</b> Resume data download</a></li>
<li class="chapter" data-level="B.3" data-path="appendixB.html"><a href="appendixB.html#googleMapsKey"><i class="fa fa-check"></i><b>B.3</b> Google Maps</a></li>
<li class="chapter" data-level="B.4" data-path="appendixB.html"><a href="appendixB.html#common-problems-and-solutions"><i class="fa fa-check"></i><b>B.4</b> Common problems and solutions:</a><ul>
<li class="chapter" data-level="B.4.1" data-path="appendixB.html"><a href="appendixB.html#i-cannot-access-project-176-i-download-0-records-from-project-176"><i class="fa fa-check"></i><b>B.4.1</b> I cannot access Project 176 / I download 0 records from Project 176</a></li>
<li class="chapter" data-level="B.4.2" data-path="appendixB.html"><a href="appendixB.html#i-get-the-message-auto-disconnecting-sqliteconnection-one-or-multiple-times-after-using-tagme"><i class="fa fa-check"></i><b>B.4.2</b> I get the message “Auto-disconnecting SQLiteConnection” one or multiple times after using tagme()</a></li>
<li class="chapter" data-level="B.4.3" data-path="appendixB.html"><a href="appendixB.html#i-get-an-internal-server-error-message-when-using-tagme-update-true"><i class="fa fa-check"></i><b>B.4.3</b> I get an “Internal Server Error” message when using tagme(…, update = TRUE)</a></li>
<li class="chapter" data-level="B.4.4" data-path="appendixB.html"><a href="appendixB.html#i-get-an-error-forbidden-message-when-using-tagme"><i class="fa fa-check"></i><b>B.4.4</b> I get an “Error: Forbidden” message when using tagme()</a></li>
<li class="chapter" data-level="B.4.5" data-path="appendixB.html"><a href="appendixB.html#i-get-an-error-object-xxxx-not-found-referring-to-a-table-or-field-name-or-some-of-your-examples-in-the-book-do-not-work."><i class="fa fa-check"></i><b>B.4.5</b> I get an error “Object ‘xxxx’ not found”, referring to a table or field name, or some of your examples in the book do not work.</a></li>
<li class="chapter" data-level="B.4.6" data-path="appendixB.html"><a href="appendixB.html#i-get-an-error-error-in-rsqlite_connectdbname-loadable.extensions-flags-vfs-could-not-connect-to-database-unable-to-open-database-file-when-attempting-to-run-tagme"><i class="fa fa-check"></i><b>B.4.6</b> I get an error <code>Error in rsqlite_connect(dbname, loadable.extensions, flags, vfs) : Could not connect to database: unable to open database file</code> when attempting to run <code>tagme()</code></a></li>
<li class="chapter" data-level="B.4.7" data-path="appendixB.html"><a href="appendixB.html#i-see-gps-coordinates-of-0-or-999"><i class="fa fa-check"></i><b>B.4.7</b> I see GPS coordinates of “0” or “999”</a></li>
<li class="chapter" data-level="B.4.8" data-path="appendixB.html"><a href="appendixB.html#i-see-port-with-a-value-of--1"><i class="fa fa-check"></i><b>B.4.8</b> I see port with a value of -1</a></li>
<li class="chapter" data-level="B.4.9" data-path="appendixB.html"><a href="appendixB.html#i-get-the-error-error-in-rsqlite_fetchresptr-n-n-database-disk-image-is-malformed"><i class="fa fa-check"></i><b>B.4.9</b> I get the error <code>Error in rsqlite_fetch(res@ptr, n = n) : database disk image is malformed</code></a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="C" data-path="appendixC.html"><a href="appendixC.html"><i class="fa fa-check"></i><b>C</b> Appendix - <code>motus</code> - Summary and plotting functions</a><ul>
<li class="chapter" data-level="C.1" data-path="appendixC.html"><a href="appendixC.html#checkVersionB"><i class="fa fa-check"></i><b>C.1</b> <code>checkVersion</code></a><ul>
<li class="chapter" data-level="C.1.1" data-path="appendixC.html"><a href="appendixC.html#description"><i class="fa fa-check"></i><b>C.1.1</b> Description</a></li>
<li class="chapter" data-level="C.1.2" data-path="appendixC.html"><a href="appendixC.html#arguments"><i class="fa fa-check"></i><b>C.1.2</b> Arguments</a></li>
<li class="chapter" data-level="C.1.3" data-path="appendixC.html"><a href="appendixC.html#example"><i class="fa fa-check"></i><b>C.1.3</b> Example</a></li>
</ul></li>
<li class="chapter" data-level="C.2" data-path="appendixC.html"><a href="appendixC.html#sunRiseSet"><i class="fa fa-check"></i><b>C.2</b> <code>sunRiseSet</code></a><ul>
<li class="chapter" data-level="C.2.1" data-path="appendixC.html"><a href="appendixC.html#description-1"><i class="fa fa-check"></i><b>C.2.1</b> Description</a></li>
<li class="chapter" data-level="C.2.2" data-path="appendixC.html"><a href="appendixC.html#arguments-1"><i class="fa fa-check"></i><b>C.2.2</b> Arguments</a></li>
<li class="chapter" data-level="C.2.3" data-path="appendixC.html"><a href="appendixC.html#example-1"><i class="fa fa-check"></i><b>C.2.3</b> Example</a></li>
</ul></li>
<li class="chapter" data-level="C.3" data-path="appendixC.html"><a href="appendixC.html#plotAllTagsCoord"><i class="fa fa-check"></i><b>C.3</b> <code>plotAllTagsCoord</code></a><ul>
<li class="chapter" data-level="C.3.1" data-path="appendixC.html"><a href="appendixC.html#description-2"><i class="fa fa-check"></i><b>C.3.1</b> Description</a></li>
<li class="chapter" data-level="C.3.2" data-path="appendixC.html"><a href="appendixC.html#arguments-2"><i class="fa fa-check"></i><b>C.3.2</b> Arguments</a></li>
<li class="chapter" data-level="C.3.3" data-path="appendixC.html"><a href="appendixC.html#example-2"><i class="fa fa-check"></i><b>C.3.3</b> Example</a></li>
</ul></li>
<li class="chapter" data-level="C.4" data-path="appendixC.html"><a href="appendixC.html#plotAllTagsSite"><i class="fa fa-check"></i><b>C.4</b> <code>plotAllTagsSite</code></a><ul>
<li class="chapter" data-level="C.4.1" data-path="appendixC.html"><a href="appendixC.html#description-3"><i class="fa fa-check"></i><b>C.4.1</b> Description</a></li>
<li class="chapter" data-level="C.4.2" data-path="appendixC.html"><a href="appendixC.html#arguments-3"><i class="fa fa-check"></i><b>C.4.2</b> Arguments</a></li>
<li class="chapter" data-level="C.4.3" data-path="appendixC.html"><a href="appendixC.html#example-3"><i class="fa fa-check"></i><b>C.4.3</b> Example</a></li>
</ul></li>
<li class="chapter" data-level="C.5" data-path="appendixC.html"><a href="appendixC.html#plotDailySiteSum"><i class="fa fa-check"></i><b>C.5</b> <code>plotDailySiteSum</code></a><ul>
<li class="chapter" data-level="C.5.1" data-path="appendixC.html"><a href="appendixC.html#description-4"><i class="fa fa-check"></i><b>C.5.1</b> Description</a></li>
<li class="chapter" data-level="C.5.2" data-path="appendixC.html"><a href="appendixC.html#arguments-4"><i class="fa fa-check"></i><b>C.5.2</b> Arguments</a></li>
<li class="chapter" data-level="C.5.3" data-path="appendixC.html"><a href="appendixC.html#example-4"><i class="fa fa-check"></i><b>C.5.3</b> Example</a></li>
</ul></li>
<li class="chapter" data-level="C.6" data-path="appendixC.html"><a href="appendixC.html#plotRouteMap"><i class="fa fa-check"></i><b>C.6</b> <code>plotRouteMap</code></a><ul>
<li class="chapter" data-level="C.6.1" data-path="appendixC.html"><a href="appendixC.html#description-5"><i class="fa fa-check"></i><b>C.6.1</b> Description</a></li>
<li class="chapter" data-level="C.6.2" data-path="appendixC.html"><a href="appendixC.html#example-5"><i class="fa fa-check"></i><b>C.6.2</b> Example</a></li>
</ul></li>
<li class="chapter" data-level="C.7" data-path="appendixC.html"><a href="appendixC.html#plotSite"><i class="fa fa-check"></i><b>C.7</b> <code>plotSite</code></a><ul>
<li class="chapter" data-level="C.7.1" data-path="appendixC.html"><a href="appendixC.html#description-6"><i class="fa fa-check"></i><b>C.7.1</b> Description</a></li>
<li class="chapter" data-level="C.7.2" data-path="appendixC.html"><a href="appendixC.html#arguments-5"><i class="fa fa-check"></i><b>C.7.2</b> Arguments</a></li>
<li class="chapter" data-level="C.7.3" data-path="appendixC.html"><a href="appendixC.html#example-6"><i class="fa fa-check"></i><b>C.7.3</b> Example</a></li>
</ul></li>
<li class="chapter" data-level="C.8" data-path="appendixC.html"><a href="appendixC.html#plotSiteSig"><i class="fa fa-check"></i><b>C.8</b> <code>plotSiteSig</code></a><ul>
<li class="chapter" data-level="C.8.1" data-path="appendixC.html"><a href="appendixC.html#description-7"><i class="fa fa-check"></i><b>C.8.1</b> Description</a></li>
<li class="chapter" data-level="C.8.2" data-path="appendixC.html"><a href="appendixC.html#arguments-6"><i class="fa fa-check"></i><b>C.8.2</b> Arguments</a></li>
<li class="chapter" data-level="C.8.3" data-path="appendixC.html"><a href="appendixC.html#example-7"><i class="fa fa-check"></i><b>C.8.3</b> Example</a></li>
</ul></li>
<li class="chapter" data-level="C.9" data-path="appendixC.html"><a href="appendixC.html#plotTagSig"><i class="fa fa-check"></i><b>C.9</b> <code>plotTagSig</code></a><ul>
<li class="chapter" data-level="C.9.1" data-path="appendixC.html"><a href="appendixC.html#description-8"><i class="fa fa-check"></i><b>C.9.1</b> Description</a></li>
<li class="chapter" data-level="C.9.2" data-path="appendixC.html"><a href="appendixC.html#arguments-7"><i class="fa fa-check"></i><b>C.9.2</b> Arguments</a></li>
<li class="chapter" data-level="C.9.3" data-path="appendixC.html"><a href="appendixC.html#example-8"><i class="fa fa-check"></i><b>C.9.3</b> Example</a></li>
</ul></li>
<li class="chapter" data-level="C.10" data-path="appendixC.html"><a href="appendixC.html#simSiteDet"><i class="fa fa-check"></i><b>C.10</b> <code>simSiteDet</code></a><ul>
<li class="chapter" data-level="C.10.1" data-path="appendixC.html"><a href="appendixC.html#description-9"><i class="fa fa-check"></i><b>C.10.1</b> Description</a></li>
<li class="chapter" data-level="C.10.2" data-path="appendixC.html"><a href="appendixC.html#arguments-8"><i class="fa fa-check"></i><b>C.10.2</b> Arguments</a></li>
<li class="chapter" data-level="C.10.3" data-path="appendixC.html"><a href="appendixC.html#example-9"><i class="fa fa-check"></i><b>C.10.3</b> Example</a></li>
</ul></li>
<li class="chapter" data-level="C.11" data-path="appendixC.html"><a href="appendixC.html#siteSum"><i class="fa fa-check"></i><b>C.11</b> <code>siteSum</code></a><ul>
<li class="chapter" data-level="C.11.1" data-path="appendixC.html"><a href="appendixC.html#description-10"><i class="fa fa-check"></i><b>C.11.1</b> Description</a></li>
<li class="chapter" data-level="C.11.2" data-path="appendixC.html"><a href="appendixC.html#arguments-9"><i class="fa fa-check"></i><b>C.11.2</b> Arguments</a></li>
<li class="chapter" data-level="C.11.3" data-path="appendixC.html"><a href="appendixC.html#example-10"><i class="fa fa-check"></i><b>C.11.3</b> Example</a></li>
</ul></li>
<li class="chapter" data-level="C.12" data-path="appendixC.html"><a href="appendixC.html#siteSumDaily"><i class="fa fa-check"></i><b>C.12</b> <code>siteSumDaily</code></a><ul>
<li class="chapter" data-level="C.12.1" data-path="appendixC.html"><a href="appendixC.html#description-11"><i class="fa fa-check"></i><b>C.12.1</b> Description</a></li>
<li class="chapter" data-level="C.12.2" data-path="appendixC.html"><a href="appendixC.html#arguments-10"><i class="fa fa-check"></i><b>C.12.2</b> Arguments</a></li>
<li class="chapter" data-level="C.12.3" data-path="appendixC.html"><a href="appendixC.html#example-11"><i class="fa fa-check"></i><b>C.12.3</b> Example</a></li>
</ul></li>
<li class="chapter" data-level="C.13" data-path="appendixC.html"><a href="appendixC.html#siteTrans"><i class="fa fa-check"></i><b>C.13</b> <code>siteTrans</code></a><ul>
<li class="chapter" data-level="C.13.1" data-path="appendixC.html"><a href="appendixC.html#description-12"><i class="fa fa-check"></i><b>C.13.1</b> Description</a></li>
<li class="chapter" data-level="C.13.2" data-path="appendixC.html"><a href="appendixC.html#arguments-11"><i class="fa fa-check"></i><b>C.13.2</b> Arguments</a></li>
<li class="chapter" data-level="C.13.3" data-path="appendixC.html"><a href="appendixC.html#example-12"><i class="fa fa-check"></i><b>C.13.3</b> Example</a></li>
</ul></li>
<li class="chapter" data-level="C.14" data-path="appendixC.html"><a href="appendixC.html#tagSum"><i class="fa fa-check"></i><b>C.14</b> <code>tagSum</code></a><ul>
<li class="chapter" data-level="C.14.1" data-path="appendixC.html"><a href="appendixC.html#description-13"><i class="fa fa-check"></i><b>C.14.1</b> Description</a></li>
<li class="chapter" data-level="C.14.2" data-path="appendixC.html"><a href="appendixC.html#arguments-12"><i class="fa fa-check"></i><b>C.14.2</b> Arguments</a></li>
<li class="chapter" data-level="C.14.3" data-path="appendixC.html"><a href="appendixC.html#example-13"><i class="fa fa-check"></i><b>C.14.3</b> Example</a></li>
</ul></li>
<li class="chapter" data-level="C.15" data-path="appendixC.html"><a href="appendixC.html#tagSumSite"><i class="fa fa-check"></i><b>C.15</b> <code>tagSumSite</code></a><ul>
<li class="chapter" data-level="C.15.1" data-path="appendixC.html"><a href="appendixC.html#description-14"><i class="fa fa-check"></i><b>C.15.1</b> Description</a></li>
<li class="chapter" data-level="C.15.2" data-path="appendixC.html"><a href="appendixC.html#arguments-13"><i class="fa fa-check"></i><b>C.15.2</b> Arguments</a></li>
<li class="chapter" data-level="C.15.3" data-path="appendixC.html"><a href="appendixC.html#example-14"><i class="fa fa-check"></i><b>C.15.3</b> Example</a></li>
</ul></li>
<li class="chapter" data-level="C.16" data-path="appendixC.html"><a href="appendixC.html#timeToSunriset"><i class="fa fa-check"></i><b>C.16</b> <code>timeToSunriset</code></a><ul>
<li class="chapter" data-level="C.16.1" data-path="appendixC.html"><a href="appendixC.html#description-15"><i class="fa fa-check"></i><b>C.16.1</b> Description</a></li>
<li class="chapter" data-level="C.16.2" data-path="appendixC.html"><a href="appendixC.html#arguments-14"><i class="fa fa-check"></i><b>C.16.2</b> Arguments</a></li>
<li class="chapter" data-level="C.16.3" data-path="appendixC.html"><a href="appendixC.html#example-15"><i class="fa fa-check"></i><b>C.16.3</b> Example</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="D" data-path="appendixD.html"><a href="appendixD.html"><i class="fa fa-check"></i><b>D</b> Appendix - <code>motus</code> - Data filtering functions</a><ul>
<li class="chapter" data-level="D.1" data-path="appendixD.html"><a href="appendixD.html#listRunsFilters"><i class="fa fa-check"></i><b>D.1</b> <code>listRunsFilters</code></a><ul>
<li class="chapter" data-level="D.1.1" data-path="appendixD.html"><a href="appendixD.html#description-16"><i class="fa fa-check"></i><b>D.1.1</b> Description</a></li>
</ul></li>
<li class="chapter" data-level="D.2" data-path="appendixD.html"><a href="appendixD.html#arguments-15"><i class="fa fa-check"></i><b>D.2</b> Arguments</a></li>
<li class="chapter" data-level="D.3" data-path="appendixD.html"><a href="appendixD.html#example-16"><i class="fa fa-check"></i><b>D.3</b> Example</a></li>
<li class="chapter" data-level="D.4" data-path="appendixD.html"><a href="appendixD.html#createRunsFilter"><i class="fa fa-check"></i><b>D.4</b> <code>createRunsFilter</code></a><ul>
<li class="chapter" data-level="D.4.1" data-path="appendixD.html"><a href="appendixD.html#description-17"><i class="fa fa-check"></i><b>D.4.1</b> Description</a></li>
<li class="chapter" data-level="D.4.2" data-path="appendixD.html"><a href="appendixD.html#arguments-16"><i class="fa fa-check"></i><b>D.4.2</b> Arguments</a></li>
<li class="chapter" data-level="D.4.3" data-path="appendixD.html"><a href="appendixD.html#example-17"><i class="fa fa-check"></i><b>D.4.3</b> Example</a></li>
</ul></li>
<li class="chapter" data-level="D.5" data-path="appendixD.html"><a href="appendixD.html#getRunsFilters"><i class="fa fa-check"></i><b>D.5</b> <code>getRunsFilters</code></a><ul>
<li class="chapter" data-level="D.5.1" data-path="appendixD.html"><a href="appendixD.html#description-18"><i class="fa fa-check"></i><b>D.5.1</b> Description</a></li>
<li class="chapter" data-level="D.5.2" data-path="appendixD.html"><a href="appendixD.html#arguments-17"><i class="fa fa-check"></i><b>D.5.2</b> Arguments</a></li>
<li class="chapter" data-level="D.5.3" data-path="appendixD.html"><a href="appendixD.html#example-18"><i class="fa fa-check"></i><b>D.5.3</b> Example</a></li>
</ul></li>
<li class="chapter" data-level="D.6" data-path="appendixD.html"><a href="appendixD.html#writeRunsFilter"><i class="fa fa-check"></i><b>D.6</b> <code>writeRunsFilter</code></a><ul>
<li class="chapter" data-level="D.6.1" data-path="appendixD.html"><a href="appendixD.html#description-19"><i class="fa fa-check"></i><b>D.6.1</b> Description</a></li>
<li class="chapter" data-level="D.6.2" data-path="appendixD.html"><a href="appendixD.html#arguments-18"><i class="fa fa-check"></i><b>D.6.2</b> Arguments</a></li>
<li class="chapter" data-level="D.6.3" data-path="appendixD.html"><a href="appendixD.html#examples"><i class="fa fa-check"></i><b>D.6.3</b> Examples</a></li>
</ul></li>
</ul></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Motus R Book</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="dataCleaning" class="section level1">
<h1><span class="header-section-number">5</span> Data Cleaning</h1>
<p><em>This chapter was contributed by Tara L. Crewe, Zoe Crysler, and Philip Taylor. Revisions by Catherine Jardine, Steffi LaZerte and Denis Lepage</em></p>
<p>There are three sources of ‘error’ that can result in tag detections appearing in your database that are incorrect.</p>
<p>First, random radio noise (‘static’) can be detected and interpreted to be the transmission of a tag. These are called ‘false positives’.</p>
<p>Second, despite our best efforts to avoid it, duplicate tags are sometimes transmitting in the network at the same time. When two tags are deployed at the same time that have the same ID code, burst interval, and nominal transmit frequency, it results in situations where the detections may belong to either tag. If that happens, we must rely on contextual information to separate them (if we can). We term these ‘Ambiguous tags’.</p>
<p>Third, a tag can appear to be present when two tags are transmitting at the same time that by chance produce a signal that looks like a third tag that is not in fact present. Such tags are most common at roosting sites or breeding colonies, where many tags are transmitting simultaneously. We term these ‘Aliased tags’. We do not deal explicitly with Aliased tags in this chapter; we are working on a way to globally identify them and eliminate them from the data. We mention them here because you may encounter situations with what appear to be highly plausible detections that don’t make biological sense. Please contact us if you think you have some of these Aliased tag detections in your database.</p>
<p>The <em>goal of this chapter</em> is to provide you with the tools you need to check your data for false detections, and remove them from your data. We do so by providing example workflows that deal with ‘false positives’ and ‘ambiguous tags’ in the following steps:</p>
<ol style="list-style-type: decimal">
<li><p><strong>Run a preliminary filter to remove all detections with <code>runLen</code> of 3 or less, and detections with intermediate <code>runLen</code>s made during periods of high noise/activity.</strong><br />
A run is a group of consecutive detections of a tag detected on a single antenna at a single receiver. In general, a detection with a run length of 2 or 3 (i.e., 2 or 3 bursts) has a high probability of being a false positive detection. With the exception of a few ‘quiet’ stations with little noise, we generally recommend that you filter out all detections with a run length of 3 or less. However, because you will likely lose some true detections in the process, we also recommend that after a full analysis of your data, you return to these detections and examine them individually, to determine (usually contextually) if they can be considered real. Stations that are particularly noisy may also have false detections with longer <code>runLen</code>s.</p></li>
<li><p><strong>Determine how many of your tag detections may be ambiguous detections</strong></p></li>
<li><p><strong>Provide a workflow for examining individual tags, and determine if runs in those tags are errors</strong></p></li>
<li><p><strong>Filter errors from your data</strong></p></li>
</ol>
<div id="loadDetectionsCleaning" class="section level2">
<h2><span class="header-section-number">5.1</span> Load required packages</h2>
<p>Follow the instructions in Chapter <a href="loadingPackages.html#loadingPackages">2</a> to install the following packages before loading, if they are not already installed.</p>
<div class="sourceCode" id="cb91"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb91-1" data-line-number="1"><span class="kw">Sys.setenv</span>(<span class="dt">tz =</span> <span class="st">&quot;UTC&quot;</span>)</a>
<a class="sourceLine" id="cb91-2" data-line-number="2"></a>
<a class="sourceLine" id="cb91-3" data-line-number="3"><span class="kw">library</span>(motus)</a>
<a class="sourceLine" id="cb91-4" data-line-number="4"><span class="kw">library</span>(tidyverse)</a>
<a class="sourceLine" id="cb91-5" data-line-number="5"><span class="kw">library</span>(lubridate)</a></code></pre></div>
</div>
<div id="load-detections-data" class="section level2">
<h2><span class="header-section-number">5.2</span> Load detections data</h2>
<p>Recall from Chapter <a href="accessingData.html#accessingData">3</a> that when accessing the sample database, you will need to input <code>motus.sample</code> in the R console as both username and password when prompted by the <code>tagme()</code> user authentication process. This section assumes you have already completed the initial sample data download.</p>
<div class="sourceCode" id="cb92"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb92-1" data-line-number="1">proj.num &lt;-<span class="st"> </span><span class="dv">176</span></a>
<a class="sourceLine" id="cb92-2" data-line-number="2">sql.motus &lt;-<span class="st"> </span><span class="kw">tagme</span>(proj.num, <span class="dt">update =</span> <span class="ot">TRUE</span>, <span class="dt">dir =</span> <span class="st">&quot;./data/&quot;</span>)</a></code></pre></div>
</div>
<div id="assess-tag-detections" class="section level2">
<h2><span class="header-section-number">5.3</span> Assess tag detections</h2>
<p>First, determine which project tags have detections. There are several reasons why deployed tags might not be detected, including:</p>
<ol style="list-style-type: decimal">
<li><p>The tag was not properly activated on deployment. To avoid this, always check that a tag is active using a hand-held receiver before attaching the tag to your study animal and releasing it.</p></li>
<li><p>An animal with a properly activated tag might not have passed within range of a receiving station. Study designs that incorporate strategic placement of receivers to meet project goals can improve the probability of a tag being detected.</p></li>
<li><p>Missing or incorrect tag deployment metadata in the Motus database can result in the data processing algorithm not ‘looking’ for your tag at the time the tag was deployed, or at all. Please ensure your tag metadata are entered correctly.</p></li>
</ol>
<p>Before going further, <strong>please check whether any of your tags were deployed more than once</strong>, as described in section <a href="deployments.html#checkNumberTagDeployments">4.3.4</a>. If so, you will need to use <code>tagDeployID</code> or a combination of <code>motusTagID</code> and <code>tagDeployID</code> to uniquely define detections associated with a tag deployment (either will do, but combining the two fields will let you know which tagID is associated with each deployment).</p>
<p>In the sample data, all tags were deployed only once, and so we use the <code>motusTagID</code> as a unique identifier for a tag deployment in all R code throughout the book.</p>
<p>Using the <code>count()</code> function we can see that there are detections for 18 tags deployed by the sample project.</p>
<div class="sourceCode" id="cb93"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb93-1" data-line-number="1"><span class="kw">tbl</span>(sql.motus, <span class="st">&quot;alltags&quot;</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb93-2" data-line-number="2"><span class="st">  </span><span class="kw">filter</span>(tagProjID <span class="op">==</span><span class="st"> </span>proj.num) <span class="op">%&gt;%</span><span class="st"> </span><span class="co"># subset to include only tags registered to project</span></a>
<a class="sourceLine" id="cb93-3" data-line-number="3"><span class="st">  </span><span class="kw">count</span>(motusTagID) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb93-4" data-line-number="4"><span class="st">  </span><span class="kw">as.data.frame</span>()</a></code></pre></div>
<pre><code>##    motusTagID     n
## 1       16011   127
## 2       16035   456
## 3       16036   118
## 4       16037  1353
## 5       16038   162
## 6       16039  1126
## 7       16044   305
## 8       16047   839
## 9       16048    98
## 10      16052   159
## 11      17357   289
## 12      19129  1288
## 13      22867  5767
## 14      22897 34796
## 15      22902  2923
## 16      22905 26010
## 17      23316  5734
## 18      23319 22759</code></pre>
<p>If we break down these counts by run length using the following code we further see that many have run lengths of 3 (the <code>run 3</code> column).</p>
<div class="sourceCode" id="cb95"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb95-1" data-line-number="1"><span class="kw">tbl</span>(sql.motus, <span class="st">&quot;alltags&quot;</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb95-2" data-line-number="2"><span class="st">  </span><span class="kw">filter</span>(tagProjID <span class="op">==</span><span class="st"> </span>proj.num) <span class="op">%&gt;%</span><span class="st"> </span><span class="co"># subset to include only tags registered to project</span></a>
<a class="sourceLine" id="cb95-3" data-line-number="3"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">rl.gt.3 =</span> <span class="kw">if_else</span>(runLen <span class="op">==</span><span class="st"> </span><span class="dv">3</span>, <span class="st">&quot;run 3&quot;</span>, <span class="st">&quot;run &gt; 3&quot;</span>)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb95-4" data-line-number="4"><span class="st">  </span><span class="kw">count</span>(motusTagID, rl.gt<span class="fl">.3</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb95-5" data-line-number="5"><span class="st">  </span><span class="kw">collect</span>() <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb95-6" data-line-number="6"><span class="st">  </span><span class="kw">spread</span>(<span class="dt">key =</span> rl.gt<span class="fl">.3</span>, <span class="dt">value =</span> n)</a></code></pre></div>
<pre><code>## # A tibble: 18 x 3
## # Groups:   motusTagID [18]
##    motusTagID `run &gt; 3` `run 3`
##         &lt;int&gt;     &lt;int&gt;   &lt;int&gt;
##  1      16011       118       9
##  2      16035       441      15
##  3      16036       115       3
##  4      16037      1335      18
##  5      16038       156       6
##  6      16039      1117       9
##  7      16044       287      18
##  8      16047       758      81
##  9      16048        83      15
## 10      16052       144      15
## 11      17357       286       3
## 12      19129      1189      99
## 13      22867      5572     195
## 14      22897     34373     423
## 15      22902      2854      69
## 16      22905     25782     228
## 17      23316      5551     183
## 18      23319     22567     192</code></pre>
<p>Although some of these may be valid detections, we have found it simpler to just remove them from our analysis, and possibly revisit them at a later stage. In the next few sections we will explore a series of filters that do just this.</p>
</div>
<div id="preliminary-filtering" class="section level2">
<h2><span class="header-section-number">5.4</span> Preliminary filtering</h2>
<p>We can perform some preliminary filtering based on run length (<code>runLen</code>). As runs are composed of sequences of hits, the longer the run the more confident we can be that it represents a true detection. However, local conditions at an individual receiver may vary in their exposure to background radio noise. Sites with relatively more background noise may be more prone to reporting false detections. Therefore the standard motus filter relies both on the length of the run, and the amount of radio activity at a given site. This value is stored as a field called <code>motusFilter</code> in the <code>runs</code> table. An additional table (<code>activity</code>) allows users to calculate a filter based on different criteria if they want.</p>
<div id="understanding-the-motusfilter" class="section level3">
<h3><span class="header-section-number">5.4.1</span> Understanding the <code>motusFilter</code></h3>
<p>Starting in July 2019, data downloaded from motus with the <code>tagme()</code> function will include a standard filter value that can be used to identify detections that we believe have a higher probability of being false hits. The various outputs on the motus web site are pre-filtered, but the R package provides access to all detections, allowing users more control over which detections to keep or omit. The <code>motusFilter</code> field in the <code>runs</code> table represents the probability that the run is a true detection. Currently the <code>motusFilter</code> contains just two values <code>0</code> or <code>1</code>. Runs with a <code>motusFilter</code> of <code>0</code> have a low probability of being true detections.</p>
</div>
<div id="how-the-motusfilter-is-generated" class="section level3">
<h3><span class="header-section-number">5.4.2</span> How the <code>motusFilter</code> is generated</h3>
<p>The <code>motusFilter</code> is based the number of detections of different run lengths at a given site, across all motus projects. Periods with lots of radio interference will typically generate a high number of very short runs that are in reality spurious data. In the presence of a high ratio of runs with length = 2 at a given time, we consider that site as ‘noisy’ and increase the minimum threshold for run lengths that we consider to be valid detections.</p>
<p>In general, a detection with a run length of 2 or 3 (i.e., 2 or 3 bursts) has a relatively high probability of being a false positive detection. Therefore, runs with a length 3 or less are conservatively assigned a <code>motusFilter</code> of 0. For runs greater than length 3, data in the <code>activity</code> table provides a method of assessing the relative amount of background noise at a site which can be used to assess the probability of these runs being true detections. The <code>activity</code> table provides the number of runs of various lengths for each hour (called <code>hourBin</code>) within each batch and for each antenna. A high number of detections within an hour (e.g., &gt;= 100) with a high proportion of short runs (e.g., length 2 &gt;= 85%) are indicative of a noisy environment, more likely to generate false positives. For those periods, we treat the intermediate run lengths (3 &lt; <code>runLen</code> &lt; 5) as invalid (<code>motusFilter</code> = 0). Intermediate run lengths are otherwise considered valid (<code>motusFilter</code> = 1).</p>
<p>The <code>motusFilter</code> values in the <code>runs</code> table have been calculated on the basis of the above criteria, which were determined through some empirical examination of data. If you are working with a dataset downloaded through <code>tagme()</code> prior to July 2019 it will not include those values. In those cases, you will either need to download a new copy of the entire dataset for your project or receiver, or to use the <code>filterByActivity()</code> function described below to calculate the missing values.</p>
<p>To omit runs identified as dubious by <code>motusFilter</code> we can use an anti-join.</p>
<div class="sourceCode" id="cb97"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb97-1" data-line-number="1"><span class="co"># Number of rows with runs 3 hits or less</span></a>
<a class="sourceLine" id="cb97-2" data-line-number="2"><span class="kw">filter</span>(<span class="kw">tbl</span>(sql.motus, <span class="st">&quot;alltags&quot;</span>), runLen <span class="op">&lt;=</span><span class="st"> </span><span class="dv">3</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb97-3" data-line-number="3"><span class="st">  </span><span class="kw">collect</span>() <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb97-4" data-line-number="4"><span class="st">  </span><span class="kw">nrow</span>()</a></code></pre></div>
<pre><code>## [1] 4511</code></pre>
<div class="sourceCode" id="cb99"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb99-1" data-line-number="1"><span class="co"># Identify runs to remove</span></a>
<a class="sourceLine" id="cb99-2" data-line-number="2">to_remove &lt;-<span class="st"> </span><span class="kw">tbl</span>(sql.motus, <span class="st">&quot;runs&quot;</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb99-3" data-line-number="3"><span class="st">  </span><span class="kw">select</span>(runID, motusFilter) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb99-4" data-line-number="4"><span class="st">  </span><span class="kw">filter</span>(motusFilter <span class="op">==</span><span class="st"> </span><span class="dv">0</span>)</a>
<a class="sourceLine" id="cb99-5" data-line-number="5"></a>
<a class="sourceLine" id="cb99-6" data-line-number="6"><span class="co"># Use anti-join to remove those runs from the alltags</span></a>
<a class="sourceLine" id="cb99-7" data-line-number="7">tbl_filtered &lt;-<span class="st"> </span><span class="kw">anti_join</span>(<span class="kw">tbl</span>(sql.motus, <span class="st">&quot;alltags&quot;</span>), to_remove, <span class="dt">by =</span> <span class="st">&quot;runID&quot;</span>)</a>
<a class="sourceLine" id="cb99-8" data-line-number="8"></a>
<a class="sourceLine" id="cb99-9" data-line-number="9"><span class="co"># Number of rows with runs 3 hits or less after being filtered</span></a>
<a class="sourceLine" id="cb99-10" data-line-number="10"><span class="kw">filter</span>(tbl_filtered, runLen <span class="op">&lt;=</span><span class="st"> </span><span class="dv">3</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb99-11" data-line-number="11"><span class="st">  </span><span class="kw">collect</span>() <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb99-12" data-line-number="12"><span class="st">  </span><span class="kw">nrow</span>()</a></code></pre></div>
<pre><code>## [1] 0</code></pre>
</div>
<div id="custom-filters-with-the-filterbyactivity-function" class="section level3">
<h3><span class="header-section-number">5.4.3</span> Custom filters with the <code>filterByActivity()</code> function</h3>
<p>The <code>motusFilter</code> is one method of determining false detections, but motus users are encouraged to explore alternative filter parameters. The <code>motus</code> R-package includes a <code>filterByActivity()</code> function that allows users to specify custom parameters used to identify false positives based on the <code>activity</code> table. Users can return either just the “true” positives (<code>return = &quot;good&quot;</code>), just the “false” positives (<code>return = &quot;bad&quot;</code>) or all hits (<code>return = &quot;all&quot;</code>) but with a new column, “probability”, which reflects either 0 (expected false positive) or 1 (expected true positive).</p>
<p>For example, the following code, adds a <code>probability</code> column to the sample project data, which is identical to the <code>motusFilter</code> column (i.e., by default <code>filterByActivity()</code> uses the same conditions).</p>
<p><strong>Note</strong> that this function requires the SQLite database connection (not a flat data frame), but returns a data.frame of the <code>alltags</code> view (not a SQLite database connection).</p>
<div class="sourceCode" id="cb101"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb101-1" data-line-number="1">tbl_motusFilter &lt;-<span class="st"> </span><span class="kw">filterByActivity</span>(sql.motus, <span class="dt">return =</span> <span class="st">&quot;all&quot;</span>)</a></code></pre></div>
<p>Users can adjust these parameters to be less strict (i.e., exclude fewer detections). This example excludes all runs of length 2 or less and will exclude any runs less than length 4 from <code>hourBin</code>s which have more than 500 runs and where at least 95% of those runs have a run length of 2.</p>
<div class="sourceCode" id="cb102"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb102-1" data-line-number="1">tbl_relaxed &lt;-<span class="st"> </span><span class="kw">filterByActivity</span>(sql.motus, <span class="dt">minLen =</span> <span class="dv">2</span>, <span class="dt">maxLen =</span> <span class="dv">4</span>, </a>
<a class="sourceLine" id="cb102-2" data-line-number="2">                                <span class="dt">maxRuns =</span> <span class="dv">500</span>, <span class="dt">ratio =</span> <span class="fl">0.95</span>, <span class="dt">return =</span> <span class="st">&quot;all&quot;</span>)</a></code></pre></div>
<p>These parameters can also be more strict (i.e., exclude more detections). This next example excludes all runs of length 4 or less and will exclude any runs less than length 10 from <code>hourBin</code>s which have more than 50 runs and where at least 75% of those runs have a run length of 2.</p>
<div class="sourceCode" id="cb103"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb103-1" data-line-number="1">tbl_strict &lt;-<span class="st"> </span><span class="kw">filterByActivity</span>(sql.motus, <span class="dt">minLen =</span> <span class="dv">4</span>, <span class="dt">maxLen =</span> <span class="dv">10</span>, </a>
<a class="sourceLine" id="cb103-2" data-line-number="2">                               <span class="dt">maxRuns =</span> <span class="dv">50</span>, <span class="dt">ratio =</span> <span class="fl">0.75</span>, <span class="dt">return =</span> <span class="st">&quot;all&quot;</span>)</a></code></pre></div>
<p>Note that the filters may exclude some true detections in the process. Therefore, we recommend that after a full analysis of your data, you return to these detections and examine them individually, to determine (usually contextually) if they can be considered real.</p>
</div>
</div>
<div id="preparing-the-data" class="section level2">
<h2><span class="header-section-number">5.5</span> Preparing the data</h2>
<p>When accessing the <code>alltags</code> view, we filter the data and remove some unnecessary variables to reduce the overall size of the data set and make it easier to work with. <strong>This is particularly important for large, unwieldy projects</strong>; details on how to view the variables in a <code>tbl</code>, and how to filter and subset prior to collecting data into a dataframe can be found in Chapter <a href="accessingData.html#convertToFlat">3.5.7</a>.</p>
<div id="label-detections-by-probability" class="section level3">
<h3><span class="header-section-number">5.5.1</span> Label detections by probability</h3>
<p>First we will use the <code>filterByActivity()</code> function to label dubious detections. This returns all the data in the <code>alltags</code> view with a new <code>probability</code> column.</p>
<div class="sourceCode" id="cb104"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb104-1" data-line-number="1">tbl.alltags &lt;-<span class="st"> </span><span class="kw">filterByActivity</span>(sql.motus, <span class="dt">return =</span> <span class="st">&quot;all&quot;</span>)</a></code></pre></div>
<p>Alternatively we can change the default, so the <code>filterByActivity()</code> function uses the <code>alltagsGPS</code> view. <strong>However,</strong> on very large databases this could be slow.</p>
<div class="sourceCode" id="cb105"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb105-1" data-line-number="1">tbl.alltags.gps &lt;-<span class="st"> </span><span class="kw">filterByActivity</span>(sql.motus, <span class="dt">return =</span> <span class="st">&quot;all&quot;</span>, <span class="dt">view =</span> <span class="st">&quot;alltagsGPS&quot;</span>)</a></code></pre></div>
</div>
<div id="clean-up" class="section level3">
<h3><span class="header-section-number">5.5.2</span> Clean up</h3>
<p>Let’s filter to the ‘good’ detections. We will filter to <code>1</code> for detections to keep and <code>0</code> for dubious detections. Then we’ll use the <code>collect()</code> and <code>as.data.frame()</code> functions to transform the dataframe into a ‘flat’ (i.e. non SQLite) file, and then transform all time stamp variables from seconds since January 1 1970 to datetime (POSIXct) format.</p>
<div class="sourceCode" id="cb106"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb106-1" data-line-number="1">df.alltags.sub &lt;-<span class="st"> </span>tbl.alltags <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb106-2" data-line-number="2"><span class="st">  </span><span class="kw">filter</span>(probability <span class="op">==</span><span class="st"> </span><span class="dv">1</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb106-3" data-line-number="3"><span class="st">  </span><span class="kw">collect</span>() <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb106-4" data-line-number="4"><span class="st">  </span><span class="kw">as.data.frame</span>() <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb106-5" data-line-number="5"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">ts =</span> <span class="kw">as_datetime</span>(ts),  <span class="co"># work with dates AFTER transforming to flat file</span></a>
<a class="sourceLine" id="cb106-6" data-line-number="6">         <span class="dt">tagDeployStart =</span> <span class="kw">as_datetime</span>(tagDeployStart),</a>
<a class="sourceLine" id="cb106-7" data-line-number="7">         <span class="dt">tagDeployEnd =</span> <span class="kw">as_datetime</span>(tagDeployEnd))</a></code></pre></div>
<p>Let us also save the excluded detections for later analysis.</p>
<div class="sourceCode" id="cb107"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb107-1" data-line-number="1">df.block<span class="fl">.0</span> &lt;-<span class="st"> </span><span class="kw">filter</span>(tbl.alltags, probability <span class="op">==</span><span class="st"> </span><span class="dv">0</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb107-2" data-line-number="2"><span class="st">  </span><span class="kw">select</span>(motusTagID, runID) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb107-3" data-line-number="3"><span class="st">  </span><span class="kw">distinct</span>() <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb107-4" data-line-number="4"><span class="st">  </span><span class="kw">collect</span>() <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb107-5" data-line-number="5"><span class="st">  </span><span class="kw">data.frame</span>()</a></code></pre></div>
</div>
<div id="addGPS" class="section level3">
<h3><span class="header-section-number">5.5.3</span> Add GPS data</h3>
<p>The <code>filterByActivity()</code> function uses the <code>alltags</code> view by default, which is faster than the <code>alltagsGPS</code> view, but does not contain GPS values.</p>
<p>However, we can use the <code>getGPS()</code> function to add in GPS values to a subset (<code>alltags</code>) after the data has been filtered.</p>
<blockquote>
<p>Note that in this example, the sample dataset doesn’t have GPS data</p>
</blockquote>
<div class="sourceCode" id="cb108"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb108-1" data-line-number="1">gps_index &lt;-<span class="st"> </span><span class="kw">getGPS</span>(sql.motus, <span class="dt">alltags =</span> df.alltags.sub, <span class="dt">by =</span> <span class="st">&quot;closest&quot;</span>)</a>
<a class="sourceLine" id="cb108-2" data-line-number="2">df.alltags.sub &lt;-<span class="st"> </span><span class="kw">left_join</span>(df.alltags.sub, gps_index, <span class="dt">by =</span> <span class="st">&quot;hitID&quot;</span>)</a></code></pre></div>
<p>We match GPS locations to <code>hitID</code>s by <code>batchID</code> and according to one of several different time values, specified by the <code>by</code> argument. This can be the <code>closest</code> location in time, the <code>daily</code> median location, or the median location within <code>X</code> minutes of a <code>hitID</code> (here, <code>X</code> can be any number greater than zero and represents the size of the time block in minutes over which to calculate a median location).</p>
<p>We then create receiver latitude and longitude variables (<code>recvLat</code>, <code>recvLon</code>, <code>recvAlt</code>) based on the coordinates recorded by the receiver GPS (<code>gpsLat</code>, <code>gpsLon</code>, <code>gpsAlt</code>), and where those are not available, infilled with coordinates from the receiver deployment metadata (<code>recvDeployLat</code>, <code>recvDeployLon</code>, <code>recvDeployAlt</code>).
Missing gps coordinates may appear as <code>NA</code> if they are missing, or as <code>0</code> or <code>999</code> if there was a problem with the unit recording.</p>
<p>Finally, we create ‘receiver names’ by adding rounded <code>recvLat</code> and <code>recvLon</code> to the <code>recvDeployName</code> for those receivers in the database that do not have these values filled in.
As more users explore (and fix!) their metadata, these missing values should begin to disappear.
We’ll fix this here as sometimes if there is missing metadata (ie. a missing receiver deployment spanning some of your detections), you will get <code>NA</code>s which can lead to problems later on.</p>
<div class="sourceCode" id="cb109"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb109-1" data-line-number="1">df.alltags.sub &lt;-<span class="st"> </span>df.alltags.sub <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb109-2" data-line-number="2"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">recvLat =</span> <span class="kw">if_else</span>((<span class="kw">is.na</span>(gpsLat)<span class="op">|</span>gpsLat <span class="op">==</span><span class="st"> </span><span class="dv">0</span><span class="op">|</span>gpsLat <span class="op">==</span><span class="st"> </span><span class="dv">999</span>), </a>
<a class="sourceLine" id="cb109-3" data-line-number="3">                           recvDeployLat, gpsLat),</a>
<a class="sourceLine" id="cb109-4" data-line-number="4">         <span class="dt">recvLon =</span> <span class="kw">if_else</span>((<span class="kw">is.na</span>(gpsLon)<span class="op">|</span>gpsLon <span class="op">==</span><span class="st"> </span><span class="dv">0</span><span class="op">|</span>gpsLon <span class="op">==</span><span class="st"> </span><span class="dv">999</span>), </a>
<a class="sourceLine" id="cb109-5" data-line-number="5">                           recvDeployLon, gpsLon),</a>
<a class="sourceLine" id="cb109-6" data-line-number="6">         <span class="dt">recvAlt =</span> <span class="kw">if_else</span>(<span class="kw">is.na</span>(gpsAlt), recvDeployAlt, gpsAlt)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb109-7" data-line-number="7"><span class="st">  </span><span class="kw">select</span>(<span class="op">-</span>noise, <span class="op">-</span>slop, <span class="op">-</span>burstSlop, <span class="op">-</span>done, <span class="op">-</span>bootnum, <span class="op">-</span>mfgID, </a>
<a class="sourceLine" id="cb109-8" data-line-number="8">         <span class="op">-</span>codeSet, <span class="op">-</span>mfg, <span class="op">-</span>nomFreq, <span class="op">-</span>markerNumber, <span class="op">-</span>markerType, </a>
<a class="sourceLine" id="cb109-9" data-line-number="9">         <span class="op">-</span>tagDepComments, <span class="op">-</span>fullID, <span class="op">-</span>deviceID, <span class="op">-</span>recvDeployLat, </a>
<a class="sourceLine" id="cb109-10" data-line-number="10">         <span class="op">-</span>recvDeployLon, <span class="op">-</span>recvDeployAlt, <span class="op">-</span>speciesGroup, <span class="op">-</span>gpsLat, </a>
<a class="sourceLine" id="cb109-11" data-line-number="11">         <span class="op">-</span>gpsLon, <span class="op">-</span>recvAlt, <span class="op">-</span>recvSiteName) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb109-12" data-line-number="12"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">recvLat =</span> plyr<span class="op">::</span><span class="kw">round_any</span>(recvLat, <span class="fl">0.05</span>), </a>
<a class="sourceLine" id="cb109-13" data-line-number="13">         <span class="dt">recvLon =</span> plyr<span class="op">::</span><span class="kw">round_any</span>(recvLon, <span class="fl">0.05</span>),</a>
<a class="sourceLine" id="cb109-14" data-line-number="14">         <span class="dt">recvDeployName =</span> <span class="kw">if_else</span>(<span class="kw">is.na</span>(recvDeployName), </a>
<a class="sourceLine" id="cb109-15" data-line-number="15">                                  <span class="kw">paste</span>(recvLat, recvLon, <span class="dt">sep=</span><span class="st">&quot;:&quot;</span>), </a>
<a class="sourceLine" id="cb109-16" data-line-number="16">                                  recvDeployName))</a>
<a class="sourceLine" id="cb109-17" data-line-number="17"></a>
<a class="sourceLine" id="cb109-18" data-line-number="18"><span class="co"># Note that in the select statement, you can just select the variables you need</span></a>
<a class="sourceLine" id="cb109-19" data-line-number="19"><span class="co"># e.g.: select(runID, ts, sig, freqsd, motusTagID, ambigID, runLen, tagProjID, </span></a>
<a class="sourceLine" id="cb109-20" data-line-number="20"><span class="co">#              tagDeployStart, tagDeployEnd, etc.)</span></a>
<a class="sourceLine" id="cb109-21" data-line-number="21"><span class="co"># As opposed to those you don&#39;t need (-done, -bootnum, etc.)</span></a></code></pre></div>
<p>Now we have a nice clean data frame!</p>
</div>
</div>
<div id="preliminary-data-checks" class="section level2">
<h2><span class="header-section-number">5.6</span> Preliminary data checks</h2>
<p>Prior to more specific filtering the data, we will perform a few summaries and plots of the data.</p>
<div id="summarize-tag-detections" class="section level3">
<h3><span class="header-section-number">5.6.1</span> Summarize tag detections</h3>
<p>An initial view of the data is best achieved by plotting. We will show you later how to plot detections on a map, but we prefer a simpler approach first; plotting detections through time by both latitude and longitude. First however, we should simplify the data. If we don’t, we risk trying to plot thousands or millions of points on a plot (which can take a long time). We’ll do this by creating a little function here, since we will use this operation again in future steps.</p>
<p>Note that we will need to remove about 150 detections, because there is no geographic data associated with the receiver metadata, and so no way to determine the location of those detections. Do a simple check to see if these receivers belong to you, and if so, please <strong>fix the metadata online</strong>!</p>
<p>For example, here we can see which receivers are missing (<code>is.na(recvLat)</code>).</p>
<div class="sourceCode" id="cb110"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb110-1" data-line-number="1">df.alltags.sub <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb110-2" data-line-number="2"><span class="st">  </span><span class="kw">filter</span>(<span class="kw">is.na</span>(recvLat)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb110-3" data-line-number="3"><span class="st">  </span><span class="kw">select</span>(recvLat, recvLon, recvDeployName, recvDeployID, recv, </a>
<a class="sourceLine" id="cb110-4" data-line-number="4">         recvProjID, recvProjName) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb110-5" data-line-number="5"><span class="st">  </span><span class="kw">distinct</span>()</a></code></pre></div>
<pre><code>##   recvLat recvLon recvDeployName recvDeployID            recv recvProjID recvProjName
## 1      NA      NA      NP mobile         3813       Lotek-280        176   SampleData
## 2      NA      NA          NA:NA           NA SG-1415BBBK0382         NA         &lt;NA&gt;
## 3      NA      NA          NA:NA           NA SG-2814BBBK0547         NA         &lt;NA&gt;</code></pre>
<p><strong>Simplify the data for plotting</strong></p>
<p>We can simplify the data by summarizing by the <code>runID</code>. If you want to summarize at a finer/coarser scale, you can also create other groups. The simplest alternative is a rounded timestamp variable; for example by using <code>mutate(ts.h = plyr::round_any(ts, 3600)</code>. Other options are to just use date (e.g <code>date = as_date(ts)</code>).</p>
<p>Here is an advanced example creating a function so we can re-use this simplification later.</p>
<div class="sourceCode" id="cb112"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb112-1" data-line-number="1">fun.getpath &lt;-<span class="st"> </span><span class="cf">function</span>(df) {</a>
<a class="sourceLine" id="cb112-2" data-line-number="2">  df <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb112-3" data-line-number="3"><span class="st">    </span><span class="kw">filter</span>(tagProjID <span class="op">==</span><span class="st"> </span>proj.num, <span class="co"># keep only tags registered to the sample project</span></a>
<a class="sourceLine" id="cb112-4" data-line-number="4">           <span class="op">!</span><span class="kw">is.na</span>(recvLat) <span class="op">|</span><span class="st"> </span><span class="op">!</span>(recvLat <span class="op">==</span><span class="st"> </span><span class="dv">0</span>)) <span class="op">%&gt;%</span><span class="st"> </span><span class="co"># drops data without lon/lat</span></a>
<a class="sourceLine" id="cb112-5" data-line-number="5"><span class="st">    </span><span class="kw">group_by</span>(motusTagID, runID, recvDeployName, ambigID, </a>
<a class="sourceLine" id="cb112-6" data-line-number="6">             tagDepLon, tagDepLat, recvLat, recvLon) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb112-7" data-line-number="7"><span class="st">    </span><span class="co">#summarizing by runID to get max run length and mean time stamp:</span></a>
<a class="sourceLine" id="cb112-8" data-line-number="8"><span class="st">    </span><span class="kw">summarize</span>(<span class="dt">max.runLen =</span> <span class="kw">max</span>(runLen), <span class="dt">ts.h =</span> <span class="kw">mean</span>(ts)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb112-9" data-line-number="9"><span class="st">    </span><span class="kw">arrange</span>(motusTagID, ts.h)</a>
<a class="sourceLine" id="cb112-10" data-line-number="10">} <span class="co"># end of function</span></a>
<a class="sourceLine" id="cb112-11" data-line-number="11"></a>
<a class="sourceLine" id="cb112-12" data-line-number="12">df.alltags.path &lt;-<span class="st"> </span><span class="kw">fun.getpath</span>(df.alltags.sub)</a></code></pre></div>
<p>We would initially plot a subset of tags by either latitude or longitude, to get an overview of where there might be issues. Here, to simplify the example, we plot only six tags. We avoid examining the ambiguous tags for now.</p>
<div class="sourceCode" id="cb113"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb113-1" data-line-number="1"><span class="kw">ggplot</span>(<span class="dt">data =</span> <span class="kw">filter</span>(df.alltags.path, </a>
<a class="sourceLine" id="cb113-2" data-line-number="2">                     motusTagID <span class="op">%in%</span><span class="st"> </span><span class="kw">c</span>(<span class="dv">16011</span>, <span class="dv">16035</span>, <span class="dv">16036</span>, <span class="dv">16037</span>, <span class="dv">16038</span>, <span class="dv">16039</span>)), </a>
<a class="sourceLine" id="cb113-3" data-line-number="3">       <span class="kw">aes</span>(<span class="dt">x =</span> ts.h, <span class="dt">y =</span> recvLat)) <span class="op">+</span></a>
<a class="sourceLine" id="cb113-4" data-line-number="4"><span class="st">  </span><span class="kw">theme_bw</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb113-5" data-line-number="5"><span class="st">  </span><span class="kw">theme</span>(<span class="dt">axis.text.x =</span> <span class="kw">element_text</span>(<span class="dt">angle =</span> <span class="dv">45</span>, <span class="dt">vjust =</span> <span class="dv">1</span>, <span class="dt">hjust =</span> <span class="dv">1</span>)) <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb113-6" data-line-number="6"><span class="st">  </span><span class="kw">geom_point</span>() <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb113-7" data-line-number="7"><span class="st">  </span><span class="kw">geom_path</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb113-8" data-line-number="8"><span class="st">  </span><span class="kw">facet_wrap</span>(<span class="op">~</span><span class="st"> </span>motusTagID, <span class="dt">scales =</span> <span class="st">&quot;free&quot;</span>, <span class="dt">ncol =</span> <span class="dv">2</span>)</a></code></pre></div>
<p><img src="MotusRBook_files/figure-html/plot1.5-1.png" width="672" /></p>
<p>Although there don’t seem to be any immediate problems, let’s take a look at the tags showing up around 44 degrees during September. Let’s examine these tags in more detail by examining the runs in the data frame that are associated with detections in September.</p>
<div class="sourceCode" id="cb114"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb114-1" data-line-number="1">df.alltags.sub <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb114-2" data-line-number="2"><span class="st">  </span><span class="kw">filter</span>(<span class="kw">month</span>(ts) <span class="op">%in%</span><span class="st"> </span><span class="kw">c</span>(<span class="dv">9</span>),</a>
<a class="sourceLine" id="cb114-3" data-line-number="3">         motusTagID <span class="op">%in%</span><span class="st"> </span><span class="kw">c</span>(<span class="dv">16035</span>, <span class="dv">16037</span>, <span class="dv">16039</span>),</a>
<a class="sourceLine" id="cb114-4" data-line-number="4">         recvLat <span class="op">&lt;</span><span class="st"> </span><span class="dv">44</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb114-5" data-line-number="5"><span class="st">  </span><span class="kw">group_by</span>(recvDeployName, <span class="kw">month</span>(ts), runLen) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb114-6" data-line-number="6"><span class="st">  </span><span class="kw">summarize</span>(<span class="dt">n =</span> <span class="kw">length</span>(ts), </a>
<a class="sourceLine" id="cb114-7" data-line-number="7">            <span class="dt">n.tags =</span> <span class="kw">length</span>(<span class="kw">unique</span>(motusTagID))) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb114-8" data-line-number="8"><span class="st">  </span><span class="kw">arrange</span>(runLen)</a></code></pre></div>
<pre><code>## # A tibble: 13 x 5
## # Groups:   recvDeployName, month(ts) [5]
##    recvDeployName        `month(ts)` runLen     n n.tags
##    &lt;chr&gt;                       &lt;dbl&gt;  &lt;int&gt; &lt;int&gt;  &lt;int&gt;
##  1 Assateague State Park           9      6     6      1
##  2 FINWR                           9      6     6      1
##  3 FINWR                           9     10    10      1
##  4 FINWR                           9     20    20      1
##  5 Prime Hook                      9     23    23      1
##  6 BULL                            9     24    24      1
##  7 Prime Hook                      9     27    27      1
##  8 Bombay Hook                     9     32    32      1
##  9 Prime Hook                      9     32    32      1
## 10 Bombay Hook                     9     36    36      1
## 11 BULL                            9     38    38      1
## 12 Bombay Hook                     9     53    53      1
## 13 FINWR                           9     73    73      1</code></pre>
<p>Since we have already filtered dubious detections, these remaining ones don’t seem immediately unreliable (all with runs of at least 6).
If you are interested, you can re-run the code above, but on the full data frame (<code>tbl(sql.motus, &quot;alltags&quot;)</code>) containing run lengths of 2 or 3.
You will see that there are likely false positive detections at these sites, that were already eliminated by filtering.
These additional detections provide further evidence that these sites experienced some radio noise during these particular months, resulting in some false positive detections.</p>
<p>You may also be interested more generally in exploring which data have only short run lengths.
For example, the following code shows the maximum run length at all sites by month (for those runs which haven’t been removed by filtering).</p>
<div class="sourceCode" id="cb116"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb116-1" data-line-number="1">df.alltags.sub <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb116-2" data-line-number="2"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">month =</span> <span class="kw">month</span>(ts)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb116-3" data-line-number="3"><span class="st">  </span><span class="kw">group_by</span>(recvDeployName, month) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb116-4" data-line-number="4"><span class="st">  </span><span class="kw">summarize</span>(<span class="dt">max.rl =</span> <span class="kw">max</span>(runLen)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb116-5" data-line-number="5"><span class="st">  </span><span class="kw">spread</span>(<span class="dt">key =</span> month, <span class="dt">value =</span> max.rl)</a></code></pre></div>
<pre><code>## # A tibble: 42 x 6
## # Groups:   recvDeployName [42]
##    recvDeployName          `4`   `5`   `8`   `9`  `10`
##    &lt;chr&gt;                 &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;int&gt;
##  1 Assateague State Park    NA    NA    NA     6    NA
##  2 BennettMeadow            NA    NA    NA    NA    11
##  3 BISE                     NA    NA    NA    NA     6
##  4 Bombay Hook              NA    NA    NA    53    NA
##  5 Brier2                   NA    NA    NA    29    NA
##  6 BSC HQ                   NA    21    NA    NA    NA
##  7 BULL                     NA    NA    NA    38     5
##  8 Comeau (Marshalltown)    NA    NA    NA     4    NA
##  9 CONY                     NA    NA    NA    NA     7
## 10 D&#39;Estimauville           NA    NA    NA    40    NA
## # … with 32 more rows</code></pre>
<p>Alternatively, you can produce a list of sites where the maximum run length of detections was never greater than (say) 4, which may sometimes (but not always!) indicate they are simply false detections.</p>
<div class="sourceCode" id="cb118"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb118-1" data-line-number="1">df.alltags.sub <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb118-2" data-line-number="2"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">month =</span> <span class="kw">month</span>(ts)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb118-3" data-line-number="3"><span class="st">  </span><span class="kw">group_by</span>(recvDeployName, month) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb118-4" data-line-number="4"><span class="st">  </span><span class="kw">summarize</span>(<span class="dt">max.rl =</span> <span class="kw">max</span>(runLen)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb118-5" data-line-number="5"><span class="st">  </span><span class="kw">filter</span>(max.rl <span class="op">&lt;</span><span class="st"> </span><span class="dv">5</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb118-6" data-line-number="6"><span class="st">  </span><span class="kw">spread</span>(<span class="dt">key =</span> month, <span class="dt">value =</span> max.rl)</a></code></pre></div>
<pre><code>## # A tibble: 3 x 4
## # Groups:   recvDeployName [3]
##   recvDeployName          `4`   `9`  `10`
##   &lt;chr&gt;                 &lt;int&gt; &lt;int&gt; &lt;int&gt;
## 1 Comeau (Marshalltown)    NA     4    NA
## 2 Old Cut                   4    NA    NA
## 3 TRUS                     NA    NA     4</code></pre>
<p>It is impossible to go through every possible issue that you may encounter here. Users are strongly encouraged to explore their data fully, and make reasoned decisions on which detections are unlikely or indeterminate. Through the rest of this chapter we will show you how to collect these runs, and apply them to your data prior to analysis.</p>
<p>To start, if we decided that those detections in September were false positives, we could create a data frame that contains the <code>motusTagID</code>s and <code>runID</code>s for them.</p>
<p>We could then re-create the plot with the newly filtered data.</p>
<div class="sourceCode" id="cb120"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb120-1" data-line-number="1"><span class="co"># Collect dubious detections</span></a>
<a class="sourceLine" id="cb120-2" data-line-number="2">df.block<span class="fl">.1</span> &lt;-<span class="st"> </span>df.alltags.sub <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb120-3" data-line-number="3"><span class="st">  </span><span class="kw">filter</span>(<span class="kw">month</span>(ts) <span class="op">%in%</span><span class="st"> </span><span class="dv">9</span>,</a>
<a class="sourceLine" id="cb120-4" data-line-number="4">         motusTagID <span class="op">%in%</span><span class="st"> </span><span class="kw">c</span>(<span class="dv">16035</span>, <span class="dv">16037</span>, <span class="dv">16039</span>)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb120-5" data-line-number="5"><span class="st">  </span><span class="kw">select</span>(motusTagID, runID) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb120-6" data-line-number="6"><span class="st">  </span><span class="kw">distinct</span>()</a>
<a class="sourceLine" id="cb120-7" data-line-number="7"></a>
<a class="sourceLine" id="cb120-8" data-line-number="8"><span class="co"># use the function we created earlier to make a new &#39;path&#39; data frame for plotting</span></a>
<a class="sourceLine" id="cb120-9" data-line-number="9">df.alltags.path &lt;-<span class="st"> </span><span class="kw">fun.getpath</span>(<span class="kw">filter</span>(df.alltags.sub, </a>
<a class="sourceLine" id="cb120-10" data-line-number="10">                                      motusTagID <span class="op">%in%</span><span class="st"> </span><span class="kw">c</span>(<span class="dv">16011</span>, <span class="dv">16035</span>, <span class="dv">16036</span>, </a>
<a class="sourceLine" id="cb120-11" data-line-number="11">                                                        <span class="dv">16037</span>, <span class="dv">16038</span>, <span class="dv">16039</span>), </a>
<a class="sourceLine" id="cb120-12" data-line-number="12">                                      <span class="op">!</span>(runID <span class="op">%in%</span><span class="st"> </span>df.block<span class="fl">.1</span><span class="op">$</span>runID)))</a>
<a class="sourceLine" id="cb120-13" data-line-number="13"></a>
<a class="sourceLine" id="cb120-14" data-line-number="14"><span class="kw">ggplot</span>(<span class="dt">data =</span> df.alltags.path, <span class="kw">aes</span>(<span class="dt">x =</span> ts.h, <span class="dt">y =</span> recvLat)) <span class="op">+</span></a>
<a class="sourceLine" id="cb120-15" data-line-number="15"><span class="st">  </span><span class="kw">theme_bw</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb120-16" data-line-number="16"><span class="st">  </span><span class="kw">theme</span>(<span class="dt">axis.text.x =</span> <span class="kw">element_text</span>(<span class="dt">angle =</span> <span class="dv">45</span>, <span class="dt">vjust =</span> <span class="dv">1</span>, <span class="dt">hjust =</span> <span class="dv">1</span>)) <span class="op">+</span></a>
<a class="sourceLine" id="cb120-17" data-line-number="17"><span class="st">  </span><span class="kw">geom_point</span>() <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb120-18" data-line-number="18"><span class="st">  </span><span class="kw">geom_path</span>() <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb120-19" data-line-number="19"><span class="st">  </span><span class="kw">facet_wrap</span>(<span class="op">~</span><span class="st"> </span>motusTagID, <span class="dt">scales =</span> <span class="st">&quot;free&quot;</span>, <span class="dt">ncol =</span> <span class="dv">2</span>)</a></code></pre></div>
<p><img src="MotusRBook_files/figure-html/createRunsFilter1-1.png" width="672" /></p>
<p>The reader is encouraged to explore the rest of the tags within this group, to determine if there are additional false positives.</p>
</div>
</div>
<div id="ambigs" class="section level2">
<h2><span class="header-section-number">5.7</span> Examining ambiguous detections</h2>
<p>Before we go further, we need to check to see if any tags have ambiguous detections. If there are, we will need to explore them, and create additional filters to remove detections from our database.</p>
<p><strong>Are any of your tags associated with ambiguous detections?</strong></p>
<p>The <code>clarify()</code> function in the <code>motus</code> R package provides a summary of ambiguities in the detections data. Each <code>ambigID</code> refers to a selection of detections that could belong to one or more (up to 6) <code>motusTagID</code>s, which are listed in the <code>id1</code> to <code>id6</code> columns:</p>
<div class="sourceCode" id="cb121"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb121-1" data-line-number="1"><span class="kw">clarify</span>(sql.motus)</a></code></pre></div>
<pre><code>##   ambigID numHits   id1                              fullID1   id2                              fullID2   id3
## 1     -56    5734 22867 SampleData#272.1:5.3@166.38(M.22867) 23316   SampleData#272:5.3@166.38(M.23316)    NA
## 2    -106     279 17021        Selva#172:6.1@166.38(M.17021) 17357   SampleData#172:6.1@166.38(M.17357)    NA
## 3    -114      86 22897 SampleData#303.1:5.3@166.38(M.22897) 24298      NEONICS#303:5.3@166.38(M.24298)    NA
## 4    -134   22749 22905   SampleData#301:5.3@166.38(M.22905) 23319 SampleData#301.1:5.3@166.38(M.23319)    NA
## 5    -171    2074 22778   RBrownAMWO#308:5.3@166.38(M.22778) 22902 SampleData#308.1:5.3@166.38(M.22902) 24303
## 6    -337       4 10811        Niles#152:6.1@166.38(M.10811) 16011   SampleData#152:6.1@166.38(M.16011)    NA
##                           fullID3 id4 fullID4 id5 fullID5 id6 fullID6 motusTagID tsStart tsEnd
## 1                            &lt;NA&gt;  NA    &lt;NA&gt;  NA    &lt;NA&gt;  NA    &lt;NA&gt;         NA      NA    NA
## 2                            &lt;NA&gt;  NA    &lt;NA&gt;  NA    &lt;NA&gt;  NA    &lt;NA&gt;         NA      NA    NA
## 3                            &lt;NA&gt;  NA    &lt;NA&gt;  NA    &lt;NA&gt;  NA    &lt;NA&gt;         NA      NA    NA
## 4                            &lt;NA&gt;  NA    &lt;NA&gt;  NA    &lt;NA&gt;  NA    &lt;NA&gt;         NA      NA    NA
## 5 NEONICS#308:5.3@166.38(M.24303)  NA    &lt;NA&gt;  NA    &lt;NA&gt;  NA    &lt;NA&gt;         NA      NA    NA
## 6                            &lt;NA&gt;  NA    &lt;NA&gt;  NA    &lt;NA&gt;  NA    &lt;NA&gt;         NA      NA    NA</code></pre>
<p>We can see that there are six tags with ambiguous detections within this data set. Detections associated with five of the six <code>ambigID</code>s could belong to one of two tags, and detections associated with one <code>ambigID</code> (<code>-171</code>) could belong to one of three tags.
The <code>fullID</code> fields list the project names associated with the duplicate tags (e.g., “SampleData”, “Selva”, “Niles”), along with features of the tags (manufacturer tag ID, burst, and transmit frequency).</p>
<p>Let’s get a data frame of these, and do some plots to see where there may be issues.</p>
<div class="sourceCode" id="cb123"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb123-1" data-line-number="1">df.ambigTags &lt;-<span class="st"> </span>df.alltags.sub <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb123-2" data-line-number="2"><span class="st">  </span><span class="kw">select</span>(ambigID, motusTagID) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb123-3" data-line-number="3"><span class="st">  </span><span class="kw">filter</span>(<span class="op">!</span><span class="kw">is.na</span>(ambigID)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb123-4" data-line-number="4"><span class="st">  </span><span class="kw">distinct</span>() </a></code></pre></div>
<p>Using our <code>getpath()</code> function, we’ll create paths and then plot these detections.
We’ll add some information to the plot, showing where (in time) the tags are actually ambiguous.
We can then inspect the overall plots (or portions of them) to determine if we can contextually unambiguously assign a detection of an ambiguous tag to a single deployment.</p>
<div class="sourceCode" id="cb124"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb124-1" data-line-number="1">df.alltags.path &lt;-<span class="st"> </span><span class="kw">fun.getpath</span>(<span class="kw">filter</span>(df.alltags.sub, </a>
<a class="sourceLine" id="cb124-2" data-line-number="2">                                      motusTagID <span class="op">%in%</span><span class="st"> </span>df.ambigTags<span class="op">$</span>motusTagID, </a>
<a class="sourceLine" id="cb124-3" data-line-number="3">                                      tagProjID <span class="op">==</span><span class="st"> </span>proj.num)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb124-4" data-line-number="4"><span class="st">  </span><span class="co"># create a boolean variable for ambiguous detections:</span></a>
<a class="sourceLine" id="cb124-5" data-line-number="5"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">Ambiguous =</span> <span class="op">!</span>(<span class="kw">is.na</span>(ambigID))) </a>
<a class="sourceLine" id="cb124-6" data-line-number="6"></a>
<a class="sourceLine" id="cb124-7" data-line-number="7"><span class="co"># to put all ambiguous tags from the same project on the same plot together, we</span></a>
<a class="sourceLine" id="cb124-8" data-line-number="8"><span class="co"># need to create a new &#39;ambig tag&#39; variable we call &#39;newID.</span></a>
<a class="sourceLine" id="cb124-9" data-line-number="9"></a>
<a class="sourceLine" id="cb124-10" data-line-number="10">ambigTags<span class="fl">.2</span> &lt;-<span class="st"> </span><span class="kw">filter</span>(df.alltags.sub) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb124-11" data-line-number="11"><span class="st">  </span><span class="kw">select</span>(ambigID, motusTagID) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb124-12" data-line-number="12"><span class="st">  </span><span class="kw">filter</span>(<span class="op">!</span><span class="kw">is.na</span>(ambigID)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb124-13" data-line-number="13"><span class="st">  </span><span class="kw">distinct</span>() <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb124-14" data-line-number="14"><span class="st">  </span><span class="kw">group_by</span>(ambigID) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb124-15" data-line-number="15"><span class="st">  </span><span class="kw">summarize</span>(<span class="dt">newID =</span> <span class="kw">paste</span>(<span class="kw">unique</span>(ambigID), <span class="kw">toString</span>(motusTagID), <span class="dt">sep =</span> <span class="st">&quot;: &quot;</span>)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb124-16" data-line-number="16"><span class="st">  </span><span class="kw">left_join</span>(df.ambigTags, <span class="dt">by =</span> <span class="st">&quot;ambigID&quot;</span>)</a>
<a class="sourceLine" id="cb124-17" data-line-number="17"></a>
<a class="sourceLine" id="cb124-18" data-line-number="18"><span class="co"># and merge that with df.alltags.path</span></a>
<a class="sourceLine" id="cb124-19" data-line-number="19">df.alltags.path &lt;-<span class="st"> </span><span class="kw">left_join</span>(df.alltags.path, ambigTags<span class="fl">.2</span>, <span class="dt">by =</span> <span class="st">&quot;motusTagID&quot;</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb124-20" data-line-number="20"><span class="st">  </span><span class="kw">arrange</span>(ts.h)</a>
<a class="sourceLine" id="cb124-21" data-line-number="21"></a>
<a class="sourceLine" id="cb124-22" data-line-number="22"><span class="kw">ggplot</span>(<span class="dt">data =</span> df.alltags.path, </a>
<a class="sourceLine" id="cb124-23" data-line-number="23">       <span class="kw">aes</span>(<span class="dt">x =</span> ts.h, <span class="dt">y =</span> recvLat, <span class="dt">group =</span> Ambiguous, <span class="dt">colour =</span> Ambiguous)) <span class="op">+</span></a>
<a class="sourceLine" id="cb124-24" data-line-number="24"><span class="st">  </span><span class="kw">theme_bw</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb124-25" data-line-number="25"><span class="st">  </span><span class="kw">theme</span>(<span class="dt">axis.text.x =</span> <span class="kw">element_text</span>(<span class="dt">angle =</span> <span class="dv">45</span>, <span class="dt">vjust =</span> <span class="dv">1</span>, <span class="dt">hjust =</span> <span class="dv">1</span>)) <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb124-26" data-line-number="26"><span class="st">  </span><span class="kw">geom_point</span>() <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb124-27" data-line-number="27"><span class="st">  </span><span class="kw">geom_path</span>() <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb124-28" data-line-number="28"><span class="st">  </span><span class="kw">facet_wrap</span>(<span class="op">~</span><span class="st"> </span>newID, <span class="dt">scales =</span> <span class="st">&quot;free&quot;</span>, <span class="dt">ncol =</span> <span class="dv">2</span>)</a></code></pre></div>
<p><img src="MotusRBook_files/figure-html/plotAmbigs-1.png" width="672" /></p>
<p>Let’s deal with the easy ones first.</p>
<p><strong>ambigID -337: <code>motusTagID</code>s 10811 and 16011</strong></p>
<div class="sourceCode" id="cb125"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb125-1" data-line-number="1">df.alltags.sub <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb125-2" data-line-number="2"><span class="st">  </span><span class="kw">filter</span>(ambigID <span class="op">==</span><span class="st"> </span><span class="dv">-337</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb125-3" data-line-number="3"><span class="st">  </span><span class="kw">count</span>(motusTagID, tagDeployStart, tagDeployEnd, tagDepLat, tagDepLon)</a></code></pre></div>
<pre><code>## # A tibble: 2 x 6
##   motusTagID tagDeployStart      tagDeployEnd        tagDepLat tagDepLon     n
##        &lt;int&gt; &lt;dttm&gt;              &lt;dttm&gt;                  &lt;dbl&gt;     &lt;dbl&gt; &lt;int&gt;
## 1      10811 2014-10-28 07:00:00 2015-08-03 07:00:00      39.1     -74.7     4
## 2      16011 2015-08-02 11:39:59 2015-12-17 11:39:59      51.5     -80.4     4</code></pre>
<p>We can see from the plot that ambiguous tag -337 is ambiguous only at the beginning of the deployment.</p>
<p>We can see from the summary of the tag deployment data that there were only 4 detections, at the exact latitude of deployment of tag 16011, and just before the non-ambiguous detections of <code>motusTagID</code> 16011. So the issue here is simply that the tail end of the deployment of tag 10811 slightly overlaps with the deployment of tag 16011. We can confidently claim these detections as belonging to motusTagID 16011, and remove the ambiguous detections assigned to the other tag.</p>
<p>We’ll create another data frame to keep track of these runs.</p>
<div class="sourceCode" id="cb127"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb127-1" data-line-number="1"><span class="co"># we want the detections associated with the motusTagID that we want to </span></a>
<a class="sourceLine" id="cb127-2" data-line-number="2"><span class="co"># ultimately REMOVE from the data frame </span></a>
<a class="sourceLine" id="cb127-3" data-line-number="3">df.block<span class="fl">.2</span> &lt;-<span class="st"> </span>df.alltags.sub <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb127-4" data-line-number="4"><span class="st">  </span><span class="kw">filter</span>(ambigID <span class="op">==</span><span class="st"> </span><span class="dv">-337</span>,</a>
<a class="sourceLine" id="cb127-5" data-line-number="5">         motusTagID <span class="op">==</span><span class="st"> </span><span class="dv">10811</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb127-6" data-line-number="6"><span class="st">  </span><span class="kw">select</span>(motusTagID, runID) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb127-7" data-line-number="7"><span class="st">  </span><span class="kw">distinct</span>()</a></code></pre></div>
<p><strong>ambigID -134: motusTagIDs 22905 and 23319</strong></p>
<div class="sourceCode" id="cb128"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb128-1" data-line-number="1">df.alltags.sub <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb128-2" data-line-number="2"><span class="st">  </span><span class="kw">filter</span>(ambigID <span class="op">==</span><span class="st"> </span><span class="dv">-134</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb128-3" data-line-number="3"><span class="st">  </span><span class="kw">count</span>(motusTagID, tagDeployStart, tagDeployEnd, </a>
<a class="sourceLine" id="cb128-4" data-line-number="4">           tagDepLat, tagDepLon, <span class="kw">month</span>(ts))</a></code></pre></div>
<pre><code>## # A tibble: 2 x 7
##   motusTagID tagDeployStart      tagDeployEnd        tagDepLat tagDepLon `month(ts)`     n
##        &lt;int&gt; &lt;dttm&gt;              &lt;dttm&gt;                  &lt;dbl&gt;     &lt;dbl&gt;       &lt;dbl&gt; &lt;int&gt;
## 1      22905 2016-10-01 16:00:00 2017-06-12 16:00:00      50.2     -63.7          10 22279
## 2      23319 2016-10-15 16:00:00 2017-06-26 16:00:00      50.2     -63.7          10 22279</code></pre>
<p>Here we have a similar situation, but one that is a bit more complex. Two identical tags were deployed at the same location, shortly after one another. Let’s examine a simple plot.</p>
<div class="sourceCode" id="cb130"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb130-1" data-line-number="1"><span class="kw">ggplot</span>(<span class="dt">data =</span> <span class="kw">filter</span>(df.alltags.sub, </a>
<a class="sourceLine" id="cb130-2" data-line-number="2">                     motusTagID <span class="op">%in%</span><span class="st"> </span><span class="kw">c</span>(<span class="dv">22905</span>, <span class="dv">23319</span>)),</a>
<a class="sourceLine" id="cb130-3" data-line-number="3">       <span class="kw">aes</span>(<span class="dt">x =</span> ts, <span class="dt">y =</span> sig, <span class="dt">group =</span> recvDeployName, <span class="dt">colour =</span> recvDeployName)) <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb130-4" data-line-number="4"><span class="st">  </span><span class="kw">geom_point</span>() <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb130-5" data-line-number="5"><span class="st">  </span><span class="kw">theme_bw</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb130-6" data-line-number="6"><span class="st">  </span><span class="kw">labs</span>(<span class="dt">x =</span> <span class="st">&quot;Time&quot;</span>, <span class="dt">y =</span> <span class="st">&quot;Signal strength&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb130-7" data-line-number="7"><span class="st">  </span><span class="kw">facet_grid</span>(recvLon <span class="op">~</span><span class="st"> </span>.)</a></code></pre></div>
<p><img src="MotusRBook_files/figure-html/ambig134b-1.png" width="672" /></p>
<p>It appears that these are overlapping detections, at two sites in proximity to one another. Additional information from the field researchers may enable us to disentangle them, but it is not clear from the data.</p>
<p>We will therefore remove all detections of this ambiguous tag from the database.</p>
<div class="sourceCode" id="cb131"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb131-1" data-line-number="1"><span class="co"># we want the detections associated with the motusTagID that we want to </span></a>
<a class="sourceLine" id="cb131-2" data-line-number="2"><span class="co"># ultimately REMOVE from the data frame </span></a>
<a class="sourceLine" id="cb131-3" data-line-number="3"></a>
<a class="sourceLine" id="cb131-4" data-line-number="4">df.block<span class="fl">.3</span> &lt;-<span class="st"> </span>df.alltags.sub <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb131-5" data-line-number="5"><span class="st">  </span><span class="kw">filter</span>(ambigID <span class="op">==</span><span class="st"> </span><span class="dv">-134</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb131-6" data-line-number="6"><span class="st">  </span><span class="kw">select</span>(motusTagID, runID) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb131-7" data-line-number="7"><span class="st">  </span><span class="kw">distinct</span>()</a></code></pre></div>
<p><strong>ambigID -171: motusTagIDs 22778, 22902 and 22403</strong></p>
<p>The ambiguous detections for this tag, which occur in the Great Lakes region, could also belong to <code>motusTagID</code> 22778 from the RBrownAMWO project or <code>motusTagID</code> 24303 from the Neonics project. Let’s take a closer look at these detections.</p>
<p>First, find the deployment dates and locations for each tag.</p>
<div class="sourceCode" id="cb132"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb132-1" data-line-number="1">df.alltags.sub <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb132-2" data-line-number="2"><span class="st">  </span><span class="kw">filter</span>(ambigID <span class="op">==</span><span class="st"> </span><span class="dv">-171</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb132-3" data-line-number="3"><span class="st">  </span><span class="kw">filter</span>(<span class="op">!</span><span class="kw">is.na</span>(tagDeployStart)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb132-4" data-line-number="4"><span class="st">  </span><span class="kw">select</span>(motusTagID, tagProjID, <span class="dt">start =</span> tagDeployStart, <span class="dt">end =</span> tagDeployEnd, </a>
<a class="sourceLine" id="cb132-5" data-line-number="5">         <span class="dt">lat =</span> tagDepLat, <span class="dt">lon =</span> tagDepLon, <span class="dt">species =</span> speciesEN) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb132-6" data-line-number="6"><span class="st">  </span><span class="kw">distinct</span>() <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb132-7" data-line-number="7"><span class="st">  </span><span class="kw">arrange</span>(start) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb132-8" data-line-number="8"><span class="st">  </span><span class="kw">collect</span>() <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb132-9" data-line-number="9"><span class="st">  </span><span class="kw">as.data.frame</span>()</a></code></pre></div>
<pre><code>##   motusTagID tagProjID               start                 end      lat       lon               species
## 1      22902       176 2016-10-01 16:00:00 2017-06-12 16:00:00 50.19278 -63.74528              Red Knot
## 2      22778        82 2016-10-21 00:00:00 2018-09-09 00:00:00 45.13535 -67.29323     American Woodcock
## 3      24303       146 2017-05-10 22:30:59 2017-06-30 22:30:59 42.60600 -80.46900 White-crowned Sparrow</code></pre>
<p>And plot the ambiguous detections.</p>
<div class="sourceCode" id="cb134"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb134-1" data-line-number="1">df.ambig<span class="fl">.171</span> &lt;-<span class="st"> </span><span class="kw">filter</span>(df.alltags.sub, ambigID <span class="op">==</span><span class="st"> </span><span class="dv">-171</span>)</a>
<a class="sourceLine" id="cb134-2" data-line-number="2"></a>
<a class="sourceLine" id="cb134-3" data-line-number="3"><span class="kw">ggplot</span>(<span class="dt">data =</span> df.ambig<span class="fl">.171</span>, <span class="kw">aes</span>(<span class="dt">x =</span> ts, <span class="dt">y =</span> sig, <span class="dt">colour =</span> <span class="kw">as.factor</span>(port))) <span class="op">+</span></a>
<a class="sourceLine" id="cb134-4" data-line-number="4"><span class="st">  </span><span class="kw">theme_bw</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb134-5" data-line-number="5"><span class="st">  </span><span class="kw">theme</span>(<span class="dt">axis.text.x =</span> <span class="kw">element_text</span>(<span class="dt">angle =</span> <span class="dv">45</span>, <span class="dt">vjust =</span> <span class="dv">1</span>, <span class="dt">hjust =</span> <span class="dv">1</span>)) <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb134-6" data-line-number="6"><span class="st">  </span><span class="kw">geom_point</span>() <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb134-7" data-line-number="7"><span class="st">  </span><span class="kw">geom_smooth</span>(<span class="dt">method =</span> <span class="st">&quot;loess&quot;</span>, <span class="dt">se =</span> <span class="ot">FALSE</span>) <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb134-8" data-line-number="8"><span class="st">  </span><span class="kw">facet_wrap</span>(<span class="kw">as_date</span>(ts) <span class="op">~</span><span class="st"> </span>recvDeployName, <span class="dt">scales =</span> <span class="st">&quot;free_x&quot;</span>)</a></code></pre></div>
<pre><code>## `geom_smooth()` using formula &#39;y ~ x&#39;</code></pre>
<p><img src="MotusRBook_files/figure-html/ambig171b-1.png" width="672" /></p>
<p>We see that there are a large number of ambiguous detections on 10 May 2017 at Old Cut (Long Point, Lake Erie, Ontario), consistent with a bird ‘hanging around’. These are almost certainly detections of motusTagID ‘24303’ which was deployed at Old Cut on 10 May 2017. Subsequent detections on the 18th of May are near Old Cut (Bird Studies Canada HQ, Port Rowan, Ontario), and then a location to the North of Old Cut (Hagersville, Ontario). These detections are consistent with a bird departing on migration. Note in particular the pattern in the latter two panels of increasing then decreasing signal strength which indicates a bird is flying through the beam of an antenna.</p>
<p>These detections belong to another project, so we simply remove all detections of that ambiguous tag from our database.</p>
<div class="sourceCode" id="cb136"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb136-1" data-line-number="1"><span class="co"># we want the detections associated with the motusTagID that we want to </span></a>
<a class="sourceLine" id="cb136-2" data-line-number="2"><span class="co"># ultimately REMOVE from the data frame </span></a>
<a class="sourceLine" id="cb136-3" data-line-number="3"></a>
<a class="sourceLine" id="cb136-4" data-line-number="4">df.block<span class="fl">.4</span> &lt;-<span class="st"> </span>df.alltags.sub <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb136-5" data-line-number="5"><span class="st">  </span><span class="kw">filter</span>(ambigID <span class="op">==</span><span class="st"> </span><span class="dv">-171</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb136-6" data-line-number="6"><span class="st">  </span><span class="kw">select</span>(motusTagID, runID) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb136-7" data-line-number="7"><span class="st">  </span><span class="kw">distinct</span>()</a></code></pre></div>
<p><strong>ambigID -114: motusTagIDs 22897 and 24298</strong></p>
<p>Next we look at the ambiguities for ambiguous tag -114.</p>
<div class="sourceCode" id="cb137"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb137-1" data-line-number="1">df.alltags.sub <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb137-2" data-line-number="2"><span class="st">  </span><span class="kw">filter</span>(ambigID <span class="op">==</span><span class="st"> </span><span class="dv">-114</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb137-3" data-line-number="3"><span class="st">  </span><span class="kw">filter</span>(<span class="op">!</span><span class="kw">is.na</span>(tagDeployStart)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb137-4" data-line-number="4"><span class="st">  </span><span class="kw">select</span>(motusTagID, tagProjID, <span class="dt">start =</span> tagDeployStart, <span class="dt">end =</span> tagDeployEnd, </a>
<a class="sourceLine" id="cb137-5" data-line-number="5">         <span class="dt">lat =</span> tagDepLat, <span class="dt">lon =</span> tagDepLon, <span class="dt">species =</span> speciesEN) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb137-6" data-line-number="6"><span class="st">  </span><span class="kw">distinct</span>() <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb137-7" data-line-number="7"><span class="st">  </span><span class="kw">arrange</span>(start) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb137-8" data-line-number="8"><span class="st">  </span><span class="kw">collect</span>() <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb137-9" data-line-number="9"><span class="st">  </span><span class="kw">as.data.frame</span>()</a></code></pre></div>
<pre><code>##   motusTagID tagProjID               start                 end      lat       lon               species
## 1      22897       176 2016-10-01 16:00:00 2017-06-12 16:00:00 50.19278 -63.74528              Red Knot
## 2      24298       146 2017-05-10 03:00:00 2017-06-30 03:00:00 42.60690 -80.46900 White-crowned Sparrow</code></pre>
<p>We again subset these and plot them. An initial plot suggested that all of the detections are of a migratory flight, so we construct a somewhat different plot from the one above, that emphasizes this behaviour better.</p>
<div class="sourceCode" id="cb139"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb139-1" data-line-number="1">df.ambig<span class="fl">.114</span> &lt;-<span class="st"> </span>df.alltags.sub <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb139-2" data-line-number="2"><span class="st">  </span><span class="kw">filter</span>(ambigID <span class="op">==</span><span class="st"> </span><span class="dv">-114</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb139-3" data-line-number="3"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">LatLonStationName =</span> <span class="kw">paste</span>(recvLat, recvLon, recvDeployName, <span class="dt">sep=</span><span class="st">&quot;: &quot;</span>))</a>
<a class="sourceLine" id="cb139-4" data-line-number="4"></a>
<a class="sourceLine" id="cb139-5" data-line-number="5"><span class="kw">ggplot</span>(<span class="dt">data =</span> df.ambig<span class="fl">.114</span>, <span class="kw">aes</span>(<span class="dt">x =</span> ts, <span class="dt">y =</span> sig, <span class="dt">colour =</span> LatLonStationName)) <span class="op">+</span></a>
<a class="sourceLine" id="cb139-6" data-line-number="6"><span class="st">  </span><span class="kw">geom_point</span>() <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb139-7" data-line-number="7"><span class="st">  </span><span class="kw">theme_bw</span>() </a></code></pre></div>
<p><img src="MotusRBook_files/figure-html/ambig114b-1.png" width="672" /></p>
<p>Notice that the detections are consistent with a migratory departure from the Long Point area (Old Cut Field Station, Lake Erie, Ontario) about a week after the ambiguous tag 24298 was deployed at the same location. This again suggests that these ambiguous detections can be removed from our data because they belong to another project.</p>
<div class="sourceCode" id="cb140"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb140-1" data-line-number="1">df.block<span class="fl">.5</span> &lt;-<span class="st"> </span>df.alltags.sub <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb140-2" data-line-number="2"><span class="st">  </span><span class="kw">filter</span>(ambigID <span class="op">==</span><span class="st"> </span><span class="dv">-114</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb140-3" data-line-number="3"><span class="st">  </span><span class="kw">select</span>(motusTagID, runID) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb140-4" data-line-number="4"><span class="st">  </span><span class="kw">distinct</span>()</a></code></pre></div>
<p><strong>ambigID -106: motusTagIDs 17021 and 17357</strong></p>
<p>These two tags pose an interesting problem. There is only a short period of overlap, between mid August 2015 and mid September. One individual is a Grey-cheeked Thrush, tagged in Colombia, the other a White-rumped Sandpiper, associated with the sample project.</p>
<div class="sourceCode" id="cb141"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb141-1" data-line-number="1">df.alltags.sub <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb141-2" data-line-number="2"><span class="st">  </span><span class="kw">filter</span>(ambigID <span class="op">==</span><span class="st"> </span><span class="dv">-106</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb141-3" data-line-number="3"><span class="st">  </span><span class="kw">filter</span>(<span class="op">!</span><span class="kw">is.na</span>(tagDeployStart)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb141-4" data-line-number="4"><span class="st">  </span><span class="kw">select</span>(motusTagID, tagProjID, <span class="dt">start =</span> tagDeployStart, <span class="dt">end =</span> tagDeployEnd, </a>
<a class="sourceLine" id="cb141-5" data-line-number="5">         <span class="dt">lat =</span> tagDepLat, <span class="dt">lon =</span> tagDepLon, <span class="dt">species =</span> speciesEN) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb141-6" data-line-number="6"><span class="st">  </span><span class="kw">distinct</span>() <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb141-7" data-line-number="7"><span class="st">  </span><span class="kw">arrange</span>(start) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb141-8" data-line-number="8"><span class="st">  </span><span class="kw">collect</span>() <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb141-9" data-line-number="9"><span class="st">  </span><span class="kw">as.data.frame</span>()</a></code></pre></div>
<pre><code>##   motusTagID tagProjID               start                 end      lat       lon                species
## 1      17021        57 2015-04-30 05:00:00 2015-09-14 05:00:00 11.12265 -74.08735    Gray-cheeked Thrush
## 2      17357       176 2015-08-11 07:20:00 2015-12-26 07:20:00 51.48390 -80.45000 White-rumped Sandpiper</code></pre>
<p>We plot the ambiguous detections to examine the period of overlap.</p>
<div class="sourceCode" id="cb143"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb143-1" data-line-number="1">df.ambig<span class="fl">.106</span> &lt;-<span class="st"> </span><span class="kw">filter</span>(df.alltags.sub, ambigID <span class="op">==</span><span class="st"> </span><span class="dv">-106</span>)</a>
<a class="sourceLine" id="cb143-2" data-line-number="2"></a>
<a class="sourceLine" id="cb143-3" data-line-number="3"><span class="kw">ggplot</span>(<span class="dt">data =</span> df.ambig<span class="fl">.106</span>, </a>
<a class="sourceLine" id="cb143-4" data-line-number="4">       <span class="kw">aes</span>(<span class="dt">x =</span> ts, <span class="dt">y =</span> sig, </a>
<a class="sourceLine" id="cb143-5" data-line-number="5">           <span class="dt">colour =</span> <span class="kw">paste</span>(recvLat, recvLon, recvDeployName, <span class="dt">sep =</span> <span class="st">&quot;: &quot;</span>))) <span class="op">+</span></a>
<a class="sourceLine" id="cb143-6" data-line-number="6"><span class="st">  </span><span class="kw">theme_bw</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb143-7" data-line-number="7"><span class="st">  </span><span class="kw">geom_point</span>() <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb143-8" data-line-number="8"><span class="st">  </span><span class="kw">scale_colour_discrete</span>(<span class="dt">name =</span> <span class="st">&quot;Lat/Lon and</span><span class="ch">\n</span><span class="st">Station Name&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb143-9" data-line-number="9"><span class="st">  </span><span class="kw">facet_wrap</span>(<span class="op">~</span><span class="st"> </span><span class="kw">as_date</span>(ts), <span class="dt">scales =</span> <span class="st">&quot;free_x&quot;</span>)</a></code></pre></div>
<p><img src="MotusRBook_files/figure-html/ambig106b-1.png" width="672" /></p>
<p>Both sets of detections are long run lengths, and look valid (increasing then decreasing signal strength). They are about a day apart, and so it is possible they represent two different birds, or the departure flight of the white-rumped sandpiper from its staging ground. Let’s use the <code>siteTrans()</code> function (in the <code>motus</code> package, see section <a href="appendixC.html#siteTrans">C.13</a>) to examine the flight from Netitishi to MDR/Seal (in the Gulf of Maine)</p>
<div class="sourceCode" id="cb144"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb144-1" data-line-number="1">df.ambig<span class="fl">.106</span> <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb144-2" data-line-number="2"><span class="st">  </span><span class="kw">filter</span>(motusTagID <span class="op">==</span><span class="st"> </span><span class="dv">17021</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="co"># just pick one of the two ambiguous IDs</span></a>
<a class="sourceLine" id="cb144-3" data-line-number="3"><span class="st">  </span><span class="kw">siteTrans</span>(<span class="dt">latCoord =</span> <span class="st">&quot;recvLat&quot;</span>, <span class="dt">lonCoord =</span> <span class="st">&quot;recvLon&quot;</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb144-4" data-line-number="4"><span class="st">  </span><span class="kw">ungroup</span>() <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb144-5" data-line-number="5"><span class="st">  </span><span class="kw">filter</span>(rate <span class="op">&lt;</span><span class="st"> </span><span class="dv">60</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="co"># remove the simultaneous detections from Seal and MDR</span></a>
<a class="sourceLine" id="cb144-6" data-line-number="6"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">total.time =</span> <span class="kw">as.numeric</span>(<span class="kw">round</span>(<span class="kw">seconds_to_period</span>(tot_ts)))) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb144-7" data-line-number="7"><span class="st">  </span><span class="kw">select</span>(<span class="dt">start =</span> recvDeployName.x, <span class="dt">end =</span> recvDeployName.y, </a>
<a class="sourceLine" id="cb144-8" data-line-number="8">         <span class="dt">date =</span> ts.x, <span class="st">`</span><span class="dt">rate(m/s)</span><span class="st">`</span> =<span class="st"> </span>rate, </a>
<a class="sourceLine" id="cb144-9" data-line-number="9">         dist, <span class="dt">total.time =</span> total.time, bearing)</a></code></pre></div>
<pre><code>## # A tibble: 1 x 7
##   start                 end           date                `rate(m/s)`     dist total.time bearing
##   &lt;chr&gt;                 &lt;chr&gt;         &lt;dttm&gt;                    &lt;dbl&gt;    &lt;dbl&gt;      &lt;dbl&gt;   &lt;dbl&gt;
## 1 Netitishi_51.3, -80.1 MDR_44, -68.2 2015-09-02 04:18:42        17.1 1211567.      70879    128.</code></pre>
<p>These detections are &gt;1200 km distant from one another, but the flight speed (17 m/s) is consistent with a white-rumped Sandpiper. Given that the Gray-cheeked Thrush tag was near the end of its expected lifetime, we can reasonably claim these detections for our project, and remove the ambiguous detections associated with <code>motusTagID</code> 17021.</p>
<div class="sourceCode" id="cb146"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb146-1" data-line-number="1">df.block<span class="fl">.6</span> &lt;-<span class="st"> </span>df.alltags.sub <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb146-2" data-line-number="2"><span class="st">  </span><span class="kw">filter</span>(ambigID <span class="op">==</span><span class="st"> </span><span class="dv">-106</span>, motusTagID <span class="op">==</span><span class="st"> </span><span class="dv">17021</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb146-3" data-line-number="3"><span class="st">  </span><span class="kw">select</span>(motusTagID, runID) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb146-4" data-line-number="4"><span class="st">  </span><span class="kw">distinct</span>()</a></code></pre></div>
<p><strong>ambigID -56: motusTagIDs 22867 and 23316</strong></p>
<p>These two tags were also both deployed by the same project.</p>
<div class="sourceCode" id="cb147"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb147-1" data-line-number="1">df.alltags.sub <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb147-2" data-line-number="2"><span class="st">  </span><span class="kw">filter</span>(ambigID <span class="op">==</span><span class="st"> </span><span class="dv">-56</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb147-3" data-line-number="3"><span class="st">  </span><span class="kw">filter</span>(<span class="op">!</span><span class="kw">is.na</span>(tagDeployStart)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb147-4" data-line-number="4"><span class="st">  </span><span class="kw">select</span>(motusTagID, tagProjID, <span class="dt">start =</span> tagDeployStart, <span class="dt">end =</span> tagDeployEnd, </a>
<a class="sourceLine" id="cb147-5" data-line-number="5">         <span class="dt">lat =</span> tagDepLat, <span class="dt">lon =</span> tagDepLon, <span class="dt">species =</span> speciesEN) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb147-6" data-line-number="6"><span class="st">  </span><span class="kw">distinct</span>() <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb147-7" data-line-number="7"><span class="st">  </span><span class="kw">arrange</span>(start) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb147-8" data-line-number="8"><span class="st">  </span><span class="kw">collect</span>() <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb147-9" data-line-number="9"><span class="st">  </span><span class="kw">as.data.frame</span>()</a></code></pre></div>
<pre><code>##   motusTagID tagProjID               start                 end      lat       lon            species
## 1      22867       176 2016-09-06 15:35:00 2017-05-18 15:35:00 51.79861 -80.69139 Pectoral Sandpiper
## 2      23316       176 2016-10-02 16:00:00 2017-06-13 16:00:00 50.19278 -63.74528           Red Knot</code></pre>
<p>Tag 23316 was deployed by the James Bay Shorebird Project (sample project) about three weeks after tag 22867, which was deployed from a location far to the west.</p>
<div class="sourceCode" id="cb149"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb149-1" data-line-number="1">df.ambig<span class="fl">.56</span> &lt;-<span class="st"> </span>df.alltags.sub <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb149-2" data-line-number="2"><span class="st">  </span><span class="kw">filter</span>(ambigID <span class="op">==</span><span class="st"> </span><span class="dv">-56</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb149-3" data-line-number="3"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">sig =</span> <span class="kw">ifelse</span>(sig <span class="op">&gt;</span><span class="st"> </span><span class="dv">0</span>, sig <span class="op">*</span><span class="st"> </span><span class="dv">-1</span>, sig))</a>
<a class="sourceLine" id="cb149-4" data-line-number="4"></a>
<a class="sourceLine" id="cb149-5" data-line-number="5"><span class="kw">ggplot</span>(<span class="dt">data =</span> df.ambig<span class="fl">.56</span>, </a>
<a class="sourceLine" id="cb149-6" data-line-number="6">       <span class="kw">aes</span>(<span class="dt">x =</span> recvLon, <span class="dt">y =</span> ts, </a>
<a class="sourceLine" id="cb149-7" data-line-number="7">           <span class="dt">colour =</span> <span class="kw">paste</span>(recvLat, recvLon, recvDeployName, <span class="dt">sep=</span><span class="st">&quot;: &quot;</span>))) <span class="op">+</span></a>
<a class="sourceLine" id="cb149-8" data-line-number="8"><span class="st">  </span><span class="kw">theme_bw</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb149-9" data-line-number="9"><span class="st">  </span><span class="kw">geom_point</span>() <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb149-10" data-line-number="10"><span class="st">  </span><span class="kw">scale_colour_discrete</span>(<span class="dt">name=</span><span class="st">&quot;Lat/Lon and</span><span class="ch">\n</span><span class="st">Station Name&quot;</span>) </a></code></pre></div>
<p><img src="MotusRBook_files/figure-html/ambig56b-1.png" width="672" /></p>
<p>We can see from the plot that a tag is detected consistently near longitude -65, which is near the deployment location for <code>motusTagID</code> 23316 and after it’s deployment start date, it was also present at -65 during and after detections far to the west. It’s likely all the detections at -65 belong to <code>motusTagID</code> 23316, but it is also clear that anything informative about this ambiguity occurs between about 9-11 October, so let’s zoom in on that part of the data set.</p>
<div class="sourceCode" id="cb150"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb150-1" data-line-number="1">ts.begin &lt;-<span class="st"> </span><span class="kw">ymd_hms</span>(<span class="st">&quot;2016-10-06 00:00:00&quot;</span>)</a>
<a class="sourceLine" id="cb150-2" data-line-number="2">ts.end &lt;-<span class="st"> </span><span class="kw">ymd_hms</span>(<span class="st">&quot;2016-10-12 23:00:00&quot;</span>)</a>
<a class="sourceLine" id="cb150-3" data-line-number="3"></a>
<a class="sourceLine" id="cb150-4" data-line-number="4"><span class="kw">ggplot</span>(<span class="dt">data =</span> <span class="kw">filter</span>(df.ambig<span class="fl">.56</span>, </a>
<a class="sourceLine" id="cb150-5" data-line-number="5">                     ts <span class="op">&gt;</span><span class="st"> </span>ts.begin, </a>
<a class="sourceLine" id="cb150-6" data-line-number="6">                     ts <span class="op">&lt;</span><span class="st"> </span>ts.end),</a>
<a class="sourceLine" id="cb150-7" data-line-number="7">       <span class="kw">aes</span>(<span class="dt">x =</span> ts, <span class="dt">y =</span> recvLon, </a>
<a class="sourceLine" id="cb150-8" data-line-number="8">           <span class="dt">colour =</span> <span class="kw">paste</span>(recvLat, recvLon, recvDeployName, <span class="dt">sep =</span> <span class="st">&quot;: &quot;</span>))) <span class="op">+</span></a>
<a class="sourceLine" id="cb150-9" data-line-number="9"><span class="st">  </span><span class="kw">theme_bw</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb150-10" data-line-number="10"><span class="st">  </span><span class="kw">geom_point</span>() <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb150-11" data-line-number="11"><span class="st">  </span><span class="kw">scale_colour_discrete</span>(<span class="dt">name =</span> <span class="st">&quot;Lat/Lon and</span><span class="ch">\n</span><span class="st">Station Name&quot;</span>) </a></code></pre></div>
<p><img src="MotusRBook_files/figure-html/ambig56c-1.png" width="672" /></p>
<p>We can see that the ambiguous tag was detected consistently at Niapiskau and Grand Ile before and after the period when it was also detected to the north and west (at Washkaugou and Piskwamish) and then to the south (NBNJ, SHNJ, and CONY). We can look at this transition by filtering out the portion of the data not near Niapiskau, and again using the siteTrans function from the motus package.</p>
<div class="sourceCode" id="cb151"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb151-1" data-line-number="1"><span class="co"># other tag is a duplicate</span></a>
<a class="sourceLine" id="cb151-2" data-line-number="2">df.<span class="fl">56.</span>tmp &lt;-<span class="st"> </span><span class="kw">filter</span>(df.ambig<span class="fl">.56</span>, <span class="op">!</span>(recvLat <span class="op">==</span><span class="st"> </span><span class="fl">50.2</span>), motusTagID <span class="op">==</span><span class="st"> </span><span class="dv">22867</span>) </a>
<a class="sourceLine" id="cb151-3" data-line-number="3"></a>
<a class="sourceLine" id="cb151-4" data-line-number="4"><span class="kw">siteTrans</span>(df.<span class="fl">56.</span>tmp, <span class="dt">latCoord =</span> <span class="st">&quot;recvLat&quot;</span>, <span class="dt">lonCoord =</span> <span class="st">&quot;recvLon&quot;</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb151-5" data-line-number="5"><span class="st">  </span><span class="kw">ungroup</span>() <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb151-6" data-line-number="6"><span class="st">  </span><span class="kw">filter</span>(rate <span class="op">&lt;</span><span class="st"> </span><span class="dv">60</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="co"># get rid of simultaneous detections</span></a>
<a class="sourceLine" id="cb151-7" data-line-number="7"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">total.time =</span> <span class="kw">as.numeric</span>(<span class="kw">round</span>(<span class="kw">seconds_to_period</span>(tot_ts)))) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb151-8" data-line-number="8"><span class="st">  </span><span class="kw">select</span>(<span class="dt">start =</span> recvDeployName.x, </a>
<a class="sourceLine" id="cb151-9" data-line-number="9">         <span class="dt">end =</span> recvDeployName.y, </a>
<a class="sourceLine" id="cb151-10" data-line-number="10">         <span class="dt">date =</span> ts.x, <span class="st">`</span><span class="dt">rate(m/s)</span><span class="st">`</span> =<span class="st"> </span>rate, </a>
<a class="sourceLine" id="cb151-11" data-line-number="11">         dist, <span class="dt">total.time =</span> total.time, bearing)</a></code></pre></div>
<pre><code>## # A tibble: 2 x 7
##   start                  end                    date                `rate(m/s)`     dist total.time bearing
##   &lt;chr&gt;                  &lt;chr&gt;                  &lt;dttm&gt;                    &lt;dbl&gt;    &lt;dbl&gt;      &lt;dbl&gt;   &lt;dbl&gt;
## 1 Piskwamish_51.7, -80.6 Washkaugou_51.2, -79.8 2016-10-09 22:49:59        20.3   76280.       3767    137.
## 2 Washkaugou_51.2, -79.8 SHNJ_40.5, -74         2016-10-10 00:00:42        24.3 1270877.      52386    157.</code></pre>
<p>The bird made a 14.5 hour flight between Washkaugou and SHNJ at a rate of 24 m/s, which is plausible. The researchers involved may have other data to support or refute the inference (e.g. an actual sighting of the Red Knot still in Niapiskau after this flight was recorded) but it seems likely that while one tag remained at sites around longitude -65, another tag made the above migratory flights. We can make another more detailed plot of signal strength to examine these potential migratory flights more closely:</p>
<div class="sourceCode" id="cb153"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb153-1" data-line-number="1">df.<span class="fl">56.</span>tmp &lt;-<span class="st"> </span><span class="kw">filter</span>(df.alltags.sub, ambigID <span class="op">==</span><span class="st"> </span><span class="dv">-56</span>, recvLon <span class="op">&lt;</span><span class="st"> </span><span class="dv">-70</span>)</a>
<a class="sourceLine" id="cb153-2" data-line-number="2"></a>
<a class="sourceLine" id="cb153-3" data-line-number="3"><span class="kw">ggplot</span>(<span class="dt">data =</span> df.<span class="fl">56.</span>tmp, </a>
<a class="sourceLine" id="cb153-4" data-line-number="4">       <span class="kw">aes</span>(<span class="dt">x =</span> ts, <span class="dt">y =</span> sig, </a>
<a class="sourceLine" id="cb153-5" data-line-number="5">           <span class="dt">colour =</span> <span class="kw">paste</span>(recvLat, recvLon, recvDeployName, <span class="dt">sep =</span> <span class="st">&quot;: &quot;</span>))) <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb153-6" data-line-number="6"><span class="st">  </span><span class="kw">theme_bw</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb153-7" data-line-number="7"><span class="st">  </span><span class="kw">geom_point</span>() <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb153-8" data-line-number="8"><span class="st">  </span><span class="kw">scale_colour_discrete</span>(<span class="dt">name =</span> <span class="st">&quot;Lat/Lon and</span><span class="ch">\n</span><span class="st">Station Name&quot;</span>) <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb153-9" data-line-number="9"><span class="st">  </span><span class="kw">facet_wrap</span>(<span class="op">~</span><span class="st"> </span><span class="kw">as_date</span>(ts), <span class="dt">scales =</span> <span class="st">&quot;free_x&quot;</span>)</a></code></pre></div>
<p><img src="MotusRBook_files/figure-html/ambig56e-1.png" width="672" /></p>
<p>These look like typical fly-by patterns of increasing and then decreasing signal strength. This, coupled with overall detection patterns and knowledge of the species, leads us to believe that the ambiguous detections can be reasonably divided between the two individuals; one detected consistently around longitude -65 (23316), and the other migrating SW during the same period (22867).</p>
<p>To address this problem, we need to create two filters - one that excludes ambiguous detections of tag 22867, and one that excludes some detections of 23316. In this instance, we can do this most easily by filtering on <code>motusTagID</code> and <code>recvDeployName.</code></p>
<div class="sourceCode" id="cb154"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb154-1" data-line-number="1"><span class="co"># tag 23316 was only ever at &quot;Grand-Ile&quot;, &quot;Niapiskau&quot;, and tag 22867 was never</span></a>
<a class="sourceLine" id="cb154-2" data-line-number="2"><span class="co"># detected at those sites. So we exclude all detections not at &quot;Grand-Ile&quot;,</span></a>
<a class="sourceLine" id="cb154-3" data-line-number="3"><span class="co"># &quot;Niapiskau&quot; for motusTag 23316, and do the opposite for tag 22867.</span></a>
<a class="sourceLine" id="cb154-4" data-line-number="4"></a>
<a class="sourceLine" id="cb154-5" data-line-number="5">df.block<span class="fl">.7</span> &lt;-<span class="st"> </span>df.alltags.sub <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb154-6" data-line-number="6"><span class="st">  </span><span class="kw">filter</span>(ambigID <span class="op">==</span><span class="st"> </span><span class="dv">-56</span>, </a>
<a class="sourceLine" id="cb154-7" data-line-number="7">         motusTagID <span class="op">==</span><span class="st"> </span><span class="dv">23316</span>, </a>
<a class="sourceLine" id="cb154-8" data-line-number="8">         <span class="op">!</span>(recvDeployName <span class="op">%in%</span><span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;Grand-Ile&quot;</span>, <span class="st">&quot;Niapiskau&quot;</span>))) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb154-9" data-line-number="9"><span class="st">  </span><span class="kw">select</span>(motusTagID, runID) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb154-10" data-line-number="10"><span class="st">  </span><span class="kw">distinct</span>()</a>
<a class="sourceLine" id="cb154-11" data-line-number="11"></a>
<a class="sourceLine" id="cb154-12" data-line-number="12">df.block<span class="fl">.8</span> &lt;-<span class="st"> </span>df.alltags.sub <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb154-13" data-line-number="13"><span class="st">  </span><span class="kw">filter</span>(ambigID <span class="op">==</span><span class="st"> </span><span class="dv">-56</span>, </a>
<a class="sourceLine" id="cb154-14" data-line-number="14">         motusTagID <span class="op">==</span><span class="st"> </span><span class="dv">22867</span>, </a>
<a class="sourceLine" id="cb154-15" data-line-number="15">         recvDeployName <span class="op">%in%</span><span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;Grand-Ile&quot;</span>, <span class="st">&quot;Niapiskau&quot;</span>)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb154-16" data-line-number="16"><span class="st">  </span><span class="kw">select</span>(motusTagID, runID) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb154-17" data-line-number="17"><span class="st">  </span><span class="kw">distinct</span>()</a></code></pre></div>
</div>
<div id="checking-validity-of-run-lengths-of-2-or-3" class="section level2">
<h2><span class="header-section-number">5.8</span> Checking validity of run lengths of 2 or 3</h2>
<p>At the beginning of this chapter, we dropped all detections with a run length of 2 or 3 or a run length of 4 in noisy conditions, because they are considered to have a high probability of being false positive. Now that we’ve cleaned the data, and are confident in the detections that remain, you might at this point decide to go back and take a closer look at those omitted detections. You could do this, for example, by re-running the various plots described in this chapter (begin with lat/lon by time plots), to see if any of those detections make sense in the context of where the true detections lie. It is up to the user to decide which detections are reasonable in terms of the biology and behaviour of each tagged individual.</p>
</div>
<div id="filtering-the-data" class="section level2">
<h2><span class="header-section-number">5.9</span> Filtering the data</h2>
<div id="filter-and-save-to-rds" class="section level3">
<h3><span class="header-section-number">5.9.1</span> Filter and save to RDS</h3>
<p>To filter the data, we can omit rows in the <code>df.block</code> data frames from the original data using a <code>anti_join()</code>, which removes rows from <code>x</code> (<code>df.alltags.sub</code>) which are present in <code>y</code> (<code>df.block</code>).</p>
<div class="sourceCode" id="cb155"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb155-1" data-line-number="1"><span class="co"># combine our df.block data frames into a single dataframe</span></a>
<a class="sourceLine" id="cb155-2" data-line-number="2">df.block.all &lt;-<span class="st"> </span><span class="kw">bind_rows</span>(df.block<span class="fl">.0</span>, df.block<span class="fl">.2</span>, df.block<span class="fl">.3</span>,</a>
<a class="sourceLine" id="cb155-3" data-line-number="3">                          df.block<span class="fl">.4</span>, df.block<span class="fl">.5</span>, df.block<span class="fl">.6</span>, df.block<span class="fl">.7</span>, </a>
<a class="sourceLine" id="cb155-4" data-line-number="4">                          df.block<span class="fl">.8</span>)</a>
<a class="sourceLine" id="cb155-5" data-line-number="5"></a>
<a class="sourceLine" id="cb155-6" data-line-number="6"></a>
<a class="sourceLine" id="cb155-7" data-line-number="7">df.alltags.sub &lt;-<span class="st"> </span><span class="kw">anti_join</span>(df.alltags.sub, df.block.all, <span class="dt">by =</span> <span class="kw">c</span>(<span class="st">&quot;runID&quot;</span>, <span class="st">&quot;motusTagID&quot;</span>))</a></code></pre></div>
<p>Now save the local data frame as an RDS file, for use in the next chapter. Recall from Section <a href="accessingData.html#exportDetections">3.6</a> that the RDS format preserves the R data structure, including time stamps. The other benefit of saving to RDS is that you have the output from a given workflow saved as a flat file, which you can access again with a simple <code>readRDS</code> statement.</p>
<div class="sourceCode" id="cb156"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb156-1" data-line-number="1"><span class="kw">saveRDS</span>(df.alltags.sub, <span class="dt">file =</span> <span class="st">&quot;./data/dfAlltagsSub.rds&quot;</span>)</a></code></pre></div>
<p>And to read the data in again:</p>
<div class="sourceCode" id="cb157"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb157-1" data-line-number="1">df.alltags.sub &lt;-<span class="st"> </span><span class="kw">readRDS</span>(<span class="st">&quot;./data/dfAlltagsSub.rds&quot;</span>)</a></code></pre></div>
</div>
<div id="saveFilter" class="section level3">
<h3><span class="header-section-number">5.9.2</span> Save a custom filter in the motus database, and apply it to the data</h3>
<p>As an alternative to saving your data as an RDS file, the Motus R package offers functionalities to save your filters directly within your .motus file. Once they are saved in your database, you can do the type of <code>anti_join()</code> as above without having to rely on dataframes or an RDS file to store your data. To learn more about the functions available to work with Motus filters, refer to <a href="%7B#appendixD%7D">Appendix D</a> for more details.</p>
<div class="sourceCode" id="cb158"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb158-1" data-line-number="1"><span class="co"># combine our df.block data frames into a single dataframe</span></a>
<a class="sourceLine" id="cb158-2" data-line-number="2">df.block.all &lt;-<span class="st"> </span><span class="kw">bind_rows</span>(df.block<span class="fl">.0</span>, df.block<span class="fl">.2</span>, df.block<span class="fl">.3</span>, </a>
<a class="sourceLine" id="cb158-3" data-line-number="3">                          df.block<span class="fl">.4</span>, df.block<span class="fl">.5</span>, df.block<span class="fl">.6</span>, df.block<span class="fl">.7</span>, </a>
<a class="sourceLine" id="cb158-4" data-line-number="4">                          df.block<span class="fl">.8</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb158-5" data-line-number="5"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">probability =</span> <span class="dv">0</span>)</a>
<a class="sourceLine" id="cb158-6" data-line-number="6"></a>
<a class="sourceLine" id="cb158-7" data-line-number="7"><span class="co"># create a new filter with name filtAmbigFalsePos and populate it with df.block.all</span></a>
<a class="sourceLine" id="cb158-8" data-line-number="8">tbl.filter &lt;-<span class="st"> </span><span class="kw">writeRunsFilter</span>(sql.motus, <span class="st">&quot;filtAmbigFalsePos&quot;</span>, </a>
<a class="sourceLine" id="cb158-9" data-line-number="9">                              <span class="dt">df =</span> df.block.all, <span class="dt">delete =</span> <span class="ot">TRUE</span>)</a></code></pre></div>
<pre><code>## Filter records saved</code></pre>
<div class="sourceCode" id="cb160"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb160-1" data-line-number="1"><span class="co"># obtain a table object where the filtered records from tbl.filter.1 have been removed</span></a>
<a class="sourceLine" id="cb160-2" data-line-number="2">tbl.alltags.sub &lt;-<span class="st"> </span><span class="kw">anti_join</span>(tbl.alltags, tbl.filter, <span class="dt">by =</span> <span class="kw">c</span>(<span class="st">&quot;runID&quot;</span>, <span class="st">&quot;motusTagID&quot;</span>))</a></code></pre></div>

</div>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="deployments.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="exploreData.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["MotusRBook.pdf"],
"toc": {
"collapse": "section"
}
});
});
</script>

</body>

</html>
